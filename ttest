CDDPCMNCgAAA0KS2VyYmVyb2FzdC5wczENCkF1dGhvcjogV2lsbCBTY2hyb2VkZXIgKEBoYXJtajB5KQ0KTGljZW5zZTogQlNEIDMtQ2xhdXNlDQpSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IE5vbmUNCg0KTm90ZTogdGhlIHByaW1hcnkgbWV0aG9kIG9mIHVzZSB3aWxsIGJlIEludm9rZS1LZXJiZXJvYXN0IHdpdGgNCnZhcmlvdXMgdGFyZ2V0aW5nIG9wdGlvbnMuDQoNCiM+DQoNCmZ1bmN0aW9uIEdldC1Eb21haW5TZWFyY2hlciB7DQo8Iw0KLlNZTk9QU0lTDQpIZWxwZXIgdXNlZCBieSB2YXJpb3VzIGZ1bmN0aW9ucyB0aGF0IGJ1aWxkcyBhIGN1c3RvbSBBRCBzZWFyY2hlciBvYmplY3QuDQpBdXRob3I6IFdpbGwgU2Nocm9lZGVyIChAaGFybWoweSkgIA0KTGljZW5zZTogQlNEIDMtQ2xhdXNlICANClJlcXVpcmVkIERlcGVuZGVuY2llczogR2V0LURvbWFpbiAgDQouREVTQ1JJUFRJT04NClRha2VzIGEgZ2l2ZW4gZG9tYWluIGFuZCBhIG51bWJlciBvZiBjdXN0b21pemF0aW9ucyBhbmQgcmV0dXJucyBhDQpTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5U2VhcmNoZXIgb2JqZWN0LiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQNCmhlYXZpbHkgYnkgb3RoZXIgTERBUC9BRFNJIHNlYXJjaGVyIGZ1bmN0aW9ucyAoVmVyYi1Eb21haW4qKS4NCi5QQVJBTUVURVIgRG9tYWluDQpTcGVjaWZpZXMgdGhlIGRvbWFpbiB0byB1c2UgZm9yIHRoZSBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLg0KLlBBUkFNRVRFUiBMREFQRmlsdGVyDQpTcGVjaWZpZXMgYW4gTERBUCBxdWVyeSBzdHJpbmcgdGhhdCBpcyB1c2VkIHRvIGZpbHRlciBBY3RpdmUgRGlyZWN0b3J5IG9iamVjdHMuDQouUEFSQU1FVEVSIFByb3BlcnRpZXMNClNwZWNpZmllcyB0aGUgcHJvcGVydGllcyBvZiB0aGUgb3V0cHV0IG9iamVjdCB0byByZXRyaWV2ZSBmcm9tIHRoZSBzZXJ2ZXIuDQouUEFSQU1FVEVSIFNlYXJjaEJhc2UNClRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIg0KVXNlZnVsIGZvciBPVSBxdWVyaWVzLg0KLlBBUkFNRVRFUiBTZWFyY2hCYXNlUHJlZml4DQpTcGVjaWZpZXMgYSBwcmVmaXggZm9yIHRoZSBMREFQIHNlYXJjaCBzdHJpbmcgKGkuZS4gIkNOPVNpdGVzLENOPUNvbmZpZ3VyYXRpb24iKS4NCi5QQVJBTUVURVIgU2VydmVyDQpTcGVjaWZpZXMgYW4gQWN0aXZlIERpcmVjdG9yeSBzZXJ2ZXIgKGRvbWFpbiBjb250cm9sbGVyKSB0byBiaW5kIHRvIGZvciB0aGUgc2VhcmNoLg0KLlBBUkFNRVRFUiBTZWFyY2hTY29wZQ0KU3BlY2lmaWVzIHRoZSBzY29wZSB0byBzZWFyY2ggdW5kZXIsIEJhc2UvT25lTGV2ZWwvU3VidHJlZSAoZGVmYXVsdCBvZiBTdWJ0cmVlKS4NCi5QQVJBTUVURVIgUmVzdWx0UGFnZVNpemUNClNwZWNpZmllcyB0aGUgUGFnZVNpemUgdG8gc2V0IGZvciB0aGUgTERBUCBzZWFyY2hlciBvYmplY3QuDQouUEFSQU1FVEVSIFJlc3VsdFBhZ2VTaXplDQpTcGVjaWZpZXMgdGhlIFBhZ2VTaXplIHRvIHNldCBmb3IgdGhlIExEQVAgc2VhcmNoZXIgb2JqZWN0Lg0KLlBBUkFNRVRFUiBTZXJ2ZXJUaW1lTGltaXQNClNwZWNpZmllcyB0aGUgbWF4aW11bSBhbW91bnQgb2YgdGltZSB0aGUgc2VydmVyIHNwZW5kcyBzZWFyY2hpbmcuIERlZmF1bHQgb2YgMTIwIHNlY29uZHMuDQouUEFSQU1FVEVSIFNlY3VyaXR5TWFza3MNClNwZWNpZmllcyBhbiBvcHRpb24gZm9yIGV4YW1pbmluZyBzZWN1cml0eSBpbmZvcm1hdGlvbiBvZiBhIGRpcmVjdG9yeSBvYmplY3QuDQpPbmUgb2YgJ0RhY2wnLCAnR3JvdXAnLCAnTm9uZScsICdPd25lcicsICdTYWNsJy4NCi5QQVJBTUVURVIgVG9tYnN0b25lDQpTd2l0Y2guIFNwZWNpZmllcyB0aGF0IHRoZSBzZWFyY2hlciBzaG91bGQgYWxzbyByZXR1cm4gZGVsZXRlZC90b21ic3RvbmVkIG9iamVjdHMuDQouUEFSQU1FVEVSIENyZWRlbnRpYWwNCkEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMNCmZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLg0KLkVYQU1QTEUNCkdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluIHRlc3RsYWIubG9jYWwNClJldHVybiBhIHNlYXJjaGVyIGZvciBhbGwgb2JqZWN0cyBpbiB0ZXN0bGFiLmxvY2FsLg0KLkVYQU1QTEUNCkdldC1Eb21haW5TZWFyY2hlciAtRG9tYWluIHRlc3RsYWIubG9jYWwgLUxEQVBGaWx0ZXIgJyhzYW1BY2NvdW50VHlwZT04MDUzMDYzNjgpJyAtUHJvcGVydGllcyAnU2FtQWNjb3VudE5hbWUsbGFzdGxvZ29uJw0KUmV0dXJuIGEgc2VhcmNoZXIgZm9yIHVzZXIgb2JqZWN0cyBpbiB0ZXN0bGFiLmxvY2FsIGFuZCBvbmx5IHJldHVybiB0aGUgU2FtQWNjb3VudE5hbWUgYW5kIExhc3RMb2dvbiBwcm9wZXJ0aWVzLg0KLkVYQU1QTEUNCkdldC1Eb21haW5TZWFyY2hlciAtU2VhcmNoQmFzZSAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIg0KUmV0dXJuIGEgc2VhcmNoZXIgdGhhdCBzZWFyY2hlcyB0aHJvdWdoIHRoZSBzcGVjaWZpYyBBRFMvTERBUCBzZWFyY2ggYmFzZSAoaS5lLiBPVSkuDQouT1VUUFVUUw0KU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeVNlYXJjaGVyDQojPg0KDQogICAgW0RpYWdub3N0aWNzLkNvZGVBbmFseXNpcy5TdXBwcmVzc01lc3NhZ2VBdHRyaWJ1dGUoJ1BTU2hvdWxkUHJvY2VzcycsICcnKV0NCiAgICBbT3V0cHV0VHlwZSgnU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeVNlYXJjaGVyJyldDQogICAgW0NtZGxldEJpbmRpbmcoKV0NCiAgICBQYXJhbSgNCiAgICAgICAgW1BhcmFtZXRlcihWYWx1ZUZyb21QaXBlbGluZSA9ICRUcnVlKV0NCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0NCiAgICAgICAgW1N0cmluZ10NCiAgICAgICAgJERvbWFpbiwNCg0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQ0KICAgICAgICBbQWxpYXMoJ0ZpbHRlcicpXQ0KICAgICAgICBbU3RyaW5nXQ0KICAgICAgICAkTERBUEZpbHRlciwNCg0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQ0KICAgICAgICBbU3RyaW5nW11dDQogICAgICAgICRQcm9wZXJ0aWVzLA0KDQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldDQogICAgICAgIFtBbGlhcygnQURTUGF0aCcpXQ0KICAgICAgICBbU3RyaW5nXQ0KICAgICAgICAkU2VhcmNoQmFzZSwNCg0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQ0KICAgICAgICBbU3RyaW5nXQ0KICAgICAgICAkU2VhcmNoQmFzZVByZWZpeCwNCg0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQ0KICAgICAgICBbQWxpYXMoJ0RvbWFpbkNvbnRyb2xsZXInKV0NCiAgICAgICAgW1N0cmluZ10NCiAgICAgICAgJFNlcnZlciwNCg0KICAgICAgICBbVmFsaWRhdGVTZXQoJ0Jhc2UnLCAnT25lTGV2ZWwnLCAnU3VidHJlZScpXQ0KICAgICAgICBbU3RyaW5nXQ0KICAgICAgICAkU2VhcmNoU2NvcGUgPSAnU3VidHJlZScsDQoNCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwgMTAwMDApXQ0KICAgICAgICBbSW50XQ0KICAgICAgICAkUmVzdWx0UGFnZVNpemUgPSAyMDAsDQoNCiAgICAgICAgW1ZhbGlkYXRlUmFuZ2UoMSwgMTAwMDApXQ0KICAgICAgICBbSW50XQ0KICAgICAgICAkU2VydmVyVGltZUxpbWl0ID0gMTIwLA0KDQogICAgICAgIFtWYWxpZGF0ZVNldCgnRGFjbCcsICdHcm91cCcsICdOb25lJywgJ093bmVyJywgJ1NhY2wnKV0NCiAgICAgICAgW1N0cmluZ10NCiAgICAgICAgJFNlY3VyaXR5TWFza3MsDQoNCiAgICAgICAgW1N3aXRjaF0NCiAgICAgICAgJFRvbWJzdG9uZSwNCg0KICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0NCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5DcmVkZW50aWFsQXR0cmlidXRlKCldDQogICAgICAgICRDcmVkZW50aWFsID0gW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdOjpFbXB0eQ0KICAgICkNCg0KICAgIFBST0NFU1Mgew0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEb21haW4nXSkgew0KICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICREb21haW4NCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICMgaWYgbm90IC1Eb21haW4gaXMgc3BlY2lmaWVkLCByZXRyaWV2ZSB0aGUgY3VycmVudCBkb21haW4gbmFtZQ0KICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQ3JlZGVudGlhbCddKSB7DQogICAgICAgICAgICAgICAgJERvbWFpbk9iamVjdCA9IEdldC1Eb21haW4gLUNyZWRlbnRpYWwgJENyZWRlbnRpYWwNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICREb21haW5PYmplY3QgPSBHZXQtRG9tYWluDQogICAgICAgICAgICB9DQogICAgICAgICAgICAkVGFyZ2V0RG9tYWluID0gJERvbWFpbk9iamVjdC5OYW1lDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoLW5vdCAkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlcnZlciddKSB7DQogICAgICAgICAgICAjIGlmIHRoZXJlJ3Mgbm90IGEgc3BlY2lmaWVkIHNlcnZlciB0byBiaW5kIHRvLCB0cnkgdG8gcHVsbCB0aGUgY3VycmVudCBkb21haW4gUERDDQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIGlmICgkRG9tYWluT2JqZWN0KSB7DQogICAgICAgICAgICAgICAgICAgICRCaW5kU2VydmVyID0gJERvbWFpbk9iamVjdC5QZGNSb2xlT3duZXIuTmFtZQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQ3JlZGVudGlhbCddKSB7DQogICAgICAgICAgICAgICAgICAgICRCaW5kU2VydmVyID0gKChHZXQtRG9tYWluIC1DcmVkZW50aWFsICRDcmVkZW50aWFsKS5QZGNSb2xlT3duZXIpLk5hbWUNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRCaW5kU2VydmVyID0gKChHZXQtRG9tYWluKS5QZGNSb2xlT3duZXIpLk5hbWUNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCB7DQogICAgICAgICAgICAgICAgdGhyb3cgIltHZXQtRG9tYWluU2VhcmNoZXJdIEVycm9yIGluIHJldHJpZXZpbmcgUERDIGZvciBjdXJyZW50IGRvbWFpbjogJF8iDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAkQmluZFNlcnZlciA9ICRTZXJ2ZXINCiAgICAgICAgfQ0KDQogICAgICAgICRTZWFyY2hTdHJpbmcgPSAnTERBUDovLycNCg0KICAgICAgICBpZiAoJEJpbmRTZXJ2ZXIgLWFuZCAoJEJpbmRTZXJ2ZXIuVHJpbSgpIC1uZSAnJykpIHsNCiAgICAgICAgICAgICRTZWFyY2hTdHJpbmcgKz0gJEJpbmRTZXJ2ZXINCiAgICAgICAgICAgIGlmICgkVGFyZ2V0RG9tYWluKSB7DQogICAgICAgICAgICAgICAgJFNlYXJjaFN0cmluZyArPSAnLycNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlYXJjaEJhc2VQcmVmaXgnXSkgew0KICAgICAgICAgICAgJFNlYXJjaFN0cmluZyArPSAkU2VhcmNoQmFzZVByZWZpeCArICcsJw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snU2VhcmNoQmFzZSddKSB7DQogICAgICAgICAgICBpZiAoJFNlYXJjaEJhc2UgLU1hdGNoICdeR0M6Ly8nKSB7DQogICAgICAgICAgICAgICAgIyBpZiB3ZSdyZSBzZWFyY2hpbmcgdGhlIGdsb2JhbCBjYXRhbG9nLCBnZXQgdGhlIHBhdGggaW4gdGhlIHJpZ2h0IGZvcm1hdA0KICAgICAgICAgICAgICAgICRETiA9ICRTZWFyY2hCYXNlLlRvVXBwZXIoKS5UcmltKCcvJykNCiAgICAgICAgICAgICAgICAkU2VhcmNoU3RyaW5nID0gJycNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgIGlmICgkU2VhcmNoQmFzZSAtbWF0Y2ggJ15MREFQOi8vJykgew0KICAgICAgICAgICAgICAgICAgICBpZiAoJFNlYXJjaEJhc2UgLW1hdGNoICJMREFQOi8vLisvLisiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkU2VhcmNoU3RyaW5nID0gJycNCiAgICAgICAgICAgICAgICAgICAgICAgICRETiA9ICRTZWFyY2hCYXNlDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkRE4gPSAkU2VhcmNoQmFzZS5TdWJTdHJpbmcoNykNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgJEROID0gJFNlYXJjaEJhc2UNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAjIHRyYW5zZm9ybSB0aGUgdGFyZ2V0IGRvbWFpbiBuYW1lIGludG8gYSBkaXN0aW5ndWlzaGVkTmFtZSBpZiBhbiBBRFMgc2VhcmNoIGJhc2UgaXMgbm90IHNwZWNpZmllZA0KICAgICAgICAgICAgaWYgKCRUYXJnZXREb21haW4gLWFuZCAoJFRhcmdldERvbWFpbi5UcmltKCkgLW5lICcnKSkgew0KICAgICAgICAgICAgICAgICRETiA9ICJEQz0kKCRUYXJnZXREb21haW4uUmVwbGFjZSgnLicsICcsREM9JykpIg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgJFNlYXJjaFN0cmluZyArPSAkRE4NCiAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0dldC1Eb21haW5TZWFyY2hlcl0gc2VhcmNoIHN0cmluZzogJFNlYXJjaFN0cmluZyINCg0KICAgICAgICBpZiAoJENyZWRlbnRpYWwgLW5lIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXTo6RW1wdHkpIHsNCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIltHZXQtRG9tYWluU2VhcmNoZXJdIFVzaW5nIGFsdGVybmF0ZSBjcmVkZW50aWFscyBmb3IgTERBUCBjb25uZWN0aW9uIg0KICAgICAgICAgICAgIyBiaW5kIHRvIHRoZSBpbml0YWwgc2VhcmNoIG9iamVjdCB1c2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMNCiAgICAgICAgICAgICREb21haW5PYmplY3QgPSBOZXctT2JqZWN0IERpcmVjdG9yeVNlcnZpY2VzLkRpcmVjdG9yeUVudHJ5KCRTZWFyY2hTdHJpbmcsICRDcmVkZW50aWFsLlVzZXJOYW1lLCAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLlBhc3N3b3JkKQ0KICAgICAgICAgICAgJFNlYXJjaGVyID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5U2VhcmNoZXIoJERvbWFpbk9iamVjdCkNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICMgYmluZCB0byB0aGUgaW5pdGFsIG9iamVjdCB1c2luZyB0aGUgY3VycmVudCBjcmVkZW50aWFscw0KICAgICAgICAgICAgJFNlYXJjaGVyID0gTmV3LU9iamVjdCBTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuRGlyZWN0b3J5U2VhcmNoZXIoW0FEU0ldJFNlYXJjaFN0cmluZykNCiAgICAgICAgfQ0KDQogICAgICAgICRTZWFyY2hlci5QYWdlU2l6ZSA9ICRSZXN1bHRQYWdlU2l6ZQ0KICAgICAgICAkU2VhcmNoZXIuU2VhcmNoU2NvcGUgPSAkU2VhcmNoU2NvcGUNCiAgICAgICAgJFNlYXJjaGVyLkNhY2hlUmVzdWx0cyA9ICRGYWxzZQ0KICAgICAgICAkU2VhcmNoZXIuUmVmZXJyYWxDaGFzaW5nID0gW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5SZWZlcnJhbENoYXNpbmdPcHRpb25dOjpBbGwNCg0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZXJ2ZXJUaW1lTGltaXQnXSkgew0KICAgICAgICAgICAgJFNlYXJjaGVyLlNlcnZlclRpbWVMaW1pdCA9ICRTZXJ2ZXJUaW1lTGltaXQNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1RvbWJzdG9uZSddKSB7DQogICAgICAgICAgICAkU2VhcmNoZXIuVG9tYnN0b25lID0gJFRydWUNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0xEQVBGaWx0ZXInXSkgew0KICAgICAgICAgICAgJFNlYXJjaGVyLmZpbHRlciA9ICRMREFQRmlsdGVyDQogICAgICAgIH0NCg0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZWN1cml0eU1hc2tzJ10pIHsNCiAgICAgICAgICAgICRTZWFyY2hlci5TZWN1cml0eU1hc2tzID0gU3dpdGNoICgkU2VjdXJpdHlNYXNrcykgew0KICAgICAgICAgICAgICAgICdEYWNsJyB7IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuU2VjdXJpdHlNYXNrc106OkRhY2wgfQ0KICAgICAgICAgICAgICAgICdHcm91cCcgeyBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlNlY3VyaXR5TWFza3NdOjpHcm91cCB9DQogICAgICAgICAgICAgICAgJ05vbmUnIHsgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5TZWN1cml0eU1hc2tzXTo6Tm9uZSB9DQogICAgICAgICAgICAgICAgJ093bmVyJyB7IFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuU2VjdXJpdHlNYXNrc106Ok93bmVyIH0NCiAgICAgICAgICAgICAgICAnU2FjbCcgeyBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLlNlY3VyaXR5TWFza3NdOjpTYWNsIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1Byb3BlcnRpZXMnXSkgew0KICAgICAgICAgICAgIyBoYW5kbGUgYW4gYXJyYXkgb2YgcHJvcGVydGllcyB0byBsb2FkIHcvIHRoZSBwb3NzaWJpbGl0eSBvZiBjb21tYS1zZXBhcmF0ZWQgc3RyaW5ncw0KICAgICAgICAgICAgJFByb3BlcnRpZXNUb0xvYWQgPSAkUHJvcGVydGllc3wgRm9yRWFjaC1PYmplY3QgeyAkXy5TcGxpdCgnLCcpIH0NCiAgICAgICAgICAgICROdWxsID0gJFNlYXJjaGVyLlByb3BlcnRpZXNUb0xvYWQuQWRkUmFuZ2UoKCRQcm9wZXJ0aWVzVG9Mb2FkKSkNCiAgICAgICAgfQ0KDQogICAgICAgICRTZWFyY2hlcg0KICAgIH0NCn0NCg0KDQpmdW5jdGlvbiBDb252ZXJ0LUxEQVBQcm9wZXJ0eSB7DQo8Iw0KLlNZTk9QU0lTDQpIZWxwZXIgdGhhdCBjb252ZXJ0cyBzcGVjaWZpYyBMREFQIHByb3BlcnR5IHJlc3VsdCBmaWVsZHMgYW5kIG91dHB1dHMNCmEgY3VzdG9tIHBzb2JqZWN0Lg0KQXV0aG9yOiBXaWxsIFNjaHJvZWRlciAoQGhhcm1qMHkpICANCkxpY2Vuc2U6IEJTRCAzLUNsYXVzZSAgDQpSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IE5vbmUgIA0KLkRFU0NSSVBUSU9ODQpDb252ZXJ0cyBhIHNldCBvZiByYXcgTERBUCBwcm9wZXJ0aWVzIHJlc3VsdHMgZnJvbSBBRFNJL0xEQVAgc2VhcmNoZXMNCmludG8gYSBwcm9wZXIgUFNPYmplY3QuIFVzZWQgYnkgc2V2ZXJhbCBvZiB0aGUgR2V0LURvbWFpbiogZnVuY3Rpb24uDQouUEFSQU1FVEVSIFByb3BlcnRpZXMNClByb3BlcnRpZXMgb2JqZWN0IHRvIGV4dHJhY3Qgb3V0IExEQVAgZmllbGRzIGZvciBkaXNwbGF5Lg0KLk9VVFBVVFMNClN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDdXN0b21PYmplY3QNCkEgY3VzdG9tIFBTT2JqZWN0IHdpdGggTERBUCBoYXNodGFibGUgcHJvcGVydGllcyB0cmFuc2xhdGVkLg0KIz4NCg0KICAgIFtEaWFnbm9zdGljcy5Db2RlQW5hbHlzaXMuU3VwcHJlc3NNZXNzYWdlQXR0cmlidXRlKCdQU1Nob3VsZFByb2Nlc3MnLCAnJyldDQogICAgW091dHB1dFR5cGUoJ1N5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDdXN0b21PYmplY3QnKV0NCiAgICBbQ21kbGV0QmluZGluZygpXQ0KICAgIFBhcmFtKA0KICAgICAgICBbUGFyYW1ldGVyKE1hbmRhdG9yeSA9ICRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZSA9ICRUcnVlKV0NCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0NCiAgICAgICAgJFByb3BlcnRpZXMNCiAgICApDQoNCiAgICAkT2JqZWN0UHJvcGVydGllcyA9IEB7fQ0KDQogICAgJFByb3BlcnRpZXMuUHJvcGVydHlOYW1lcyB8IEZvckVhY2gtT2JqZWN0IHsNCiAgICAgICAgaWYgKCRfIC1uZSAnYWRzcGF0aCcpIHsNCiAgICAgICAgICAgIGlmICgoJF8gLWVxICdvYmplY3RzaWQnKSAtb3IgKCRfIC1lcSAnc2lkaGlzdG9yeScpKSB7DQogICAgICAgICAgICAgICAgIyBjb252ZXJ0IGFsbCBsaXN0ZWQgc2lkcyAoaS5lLiBpZiBtdWx0aXBsZSBhcmUgbGlzdGVkIGluIHNpZEhpc3RvcnkpDQogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BlcnRpZXNbJF9dIHwgRm9yRWFjaC1PYmplY3QgeyAoTmV3LU9iamVjdCBTeXN0ZW0uU2VjdXJpdHkuUHJpbmNpcGFsLlNlY3VyaXR5SWRlbnRpZmllcigkXywgMCkpLlZhbHVlIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2VpZiAoJF8gLWVxICdncm91cHR5cGUnKSB7DQogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BlcnRpZXNbJF9dWzBdIC1hcyAkR3JvdXBUeXBlRW51bQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZWlmICgkXyAtZXEgJ3NhbWFjY291bnR0eXBlJykgew0KICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9ICRQcm9wZXJ0aWVzWyRfXVswXSAtYXMgJFNhbUFjY291bnRUeXBlRW51bQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZWlmICgkXyAtZXEgJ29iamVjdGd1aWQnKSB7DQogICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRoZSBHVUlEIHRvIGEgc3RyaW5nDQogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gKE5ldy1PYmplY3QgR3VpZCAoLCRQcm9wZXJ0aWVzWyRfXVswXSkpLkd1aWQNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2VpZiAoJF8gLWVxICd1c2VyYWNjb3VudGNvbnRyb2wnKSB7DQogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BlcnRpZXNbJF9dWzBdIC1hcyAkVUFDRW51bQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZWlmICgkXyAtZXEgJ250c2VjdXJpdHlkZXNjcmlwdG9yJykgew0KICAgICAgICAgICAgICAgICMgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gTmV3LU9iamVjdCBTZWN1cml0eS5BY2Nlc3NDb250cm9sLlJhd1NlY3VyaXR5RGVzY3JpcHRvciAtQXJndW1lbnRMaXN0ICRQcm9wZXJ0aWVzWyRfXVswXSwgMA0KICAgICAgICAgICAgICAgICREZXNjcmlwdG9yID0gTmV3LU9iamVjdCBTZWN1cml0eS5BY2Nlc3NDb250cm9sLlJhd1NlY3VyaXR5RGVzY3JpcHRvciAtQXJndW1lbnRMaXN0ICRQcm9wZXJ0aWVzWyRfXVswXSwgMA0KICAgICAgICAgICAgICAgIGlmICgkRGVzY3JpcHRvci5Pd25lcikgew0KICAgICAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1snT3duZXInXSA9ICREZXNjcmlwdG9yLk93bmVyDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkRGVzY3JpcHRvci5Hcm91cCkgew0KICAgICAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1snR3JvdXAnXSA9ICREZXNjcmlwdG9yLkdyb3VwDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkRGVzY3JpcHRvci5EaXNjcmV0aW9uYXJ5QWNsKSB7DQogICAgICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWydEaXNjcmV0aW9uYXJ5QWNsJ10gPSAkRGVzY3JpcHRvci5EaXNjcmV0aW9uYXJ5QWNsDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICgkRGVzY3JpcHRvci5TeXN0ZW1BY2wpIHsNCiAgICAgICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJ1N5c3RlbUFjbCddID0gJERlc2NyaXB0b3IuU3lzdGVtQWNsDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZWlmICgkXyAtZXEgJ2FjY291bnRleHBpcmVzJykgew0KICAgICAgICAgICAgICAgIGlmICgkUHJvcGVydGllc1skX11bMF0gLWd0IFtEYXRlVGltZV06Ok1heFZhbHVlLlRpY2tzKSB7DQogICAgICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9ICJORVZFUiINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9IFtkYXRldGltZV06OmZyb21maWxldGltZSgkUHJvcGVydGllc1skX11bMF0pDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZWlmICggKCRfIC1lcSAnbGFzdGxvZ29uJykgLW9yICgkXyAtZXEgJ2xhc3Rsb2dvbnRpbWVzdGFtcCcpIC1vciAoJF8gLWVxICdwd2RsYXN0c2V0JykgLW9yICgkXyAtZXEgJ2xhc3Rsb2dvZmYnKSAtb3IgKCRfIC1lcSAnYmFkUGFzc3dvcmRUaW1lJykgKSB7DQogICAgICAgICAgICAgICAgIyBjb252ZXJ0IHRpbWVzdGFtcHMNCiAgICAgICAgICAgICAgICBpZiAoJFByb3BlcnRpZXNbJF9dWzBdIC1pcyBbU3lzdGVtLk1hcnNoYWxCeVJlZk9iamVjdF0pIHsNCiAgICAgICAgICAgICAgICAgICAgIyBpZiB3ZSBoYXZlIGEgU3lzdGVtLl9fQ29tT2JqZWN0DQogICAgICAgICAgICAgICAgICAgICRUZW1wID0gJFByb3BlcnRpZXNbJF9dWzBdDQogICAgICAgICAgICAgICAgICAgIFtJbnQzMl0kSGlnaCA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0hpZ2hQYXJ0JywgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkTnVsbCwgJFRlbXAsICROdWxsKQ0KICAgICAgICAgICAgICAgICAgICBbSW50MzJdJExvdyAgPSAkVGVtcC5HZXRUeXBlKCkuSW52b2tlTWVtYmVyKCdMb3dQYXJ0JywgIFtTeXN0ZW0uUmVmbGVjdGlvbi5CaW5kaW5nRmxhZ3NdOjpHZXRQcm9wZXJ0eSwgJE51bGwsICRUZW1wLCAkTnVsbCkNCiAgICAgICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gKFtkYXRldGltZV06OkZyb21GaWxlVGltZShbSW50NjRdKCIweHswOng4fXsxOng4fSIgLWYgJEhpZ2gsICRMb3cpKSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICMgb3RoZXJ3aXNlIGp1c3QgYSBzdHJpbmcNCiAgICAgICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gKFtkYXRldGltZV06OkZyb21GaWxlVGltZSgoJFByb3BlcnRpZXNbJF9dWzBdKSkpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZWlmICgkUHJvcGVydGllc1skX11bMF0gLWlzIFtTeXN0ZW0uTWFyc2hhbEJ5UmVmT2JqZWN0XSkgew0KICAgICAgICAgICAgICAgICMgdHJ5IHRvIGNvbnZlcnQgbWlzYyBjb20gb2JqZWN0cw0KICAgICAgICAgICAgICAgICRQcm9wID0gJFByb3BlcnRpZXNbJF9dDQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgJFRlbXAgPSAkUHJvcFskX11bMF0NCiAgICAgICAgICAgICAgICAgICAgW0ludDMyXSRIaWdoID0gJFRlbXAuR2V0VHlwZSgpLkludm9rZU1lbWJlcignSGlnaFBhcnQnLCBbU3lzdGVtLlJlZmxlY3Rpb24uQmluZGluZ0ZsYWdzXTo6R2V0UHJvcGVydHksICROdWxsLCAkVGVtcCwgJE51bGwpDQogICAgICAgICAgICAgICAgICAgIFtJbnQzMl0kTG93ICA9ICRUZW1wLkdldFR5cGUoKS5JbnZva2VNZW1iZXIoJ0xvd1BhcnQnLCAgW1N5c3RlbS5SZWZsZWN0aW9uLkJpbmRpbmdGbGFnc106OkdldFByb3BlcnR5LCAkTnVsbCwgJFRlbXAsICROdWxsKQ0KICAgICAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSBbSW50NjRdKCIweHswOng4fXsxOng4fSIgLWYgJEhpZ2gsICRMb3cpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIHsNCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0NvbnZlcnQtTERBUFByb3BlcnR5XSBlcnJvcjogJF8iDQogICAgICAgICAgICAgICAgICAgICRPYmplY3RQcm9wZXJ0aWVzWyRfXSA9ICRQcm9wWyRfXQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2VpZiAoJFByb3BlcnRpZXNbJF9dLmNvdW50IC1lcSAxKSB7DQogICAgICAgICAgICAgICAgJE9iamVjdFByb3BlcnRpZXNbJF9dID0gJFByb3BlcnRpZXNbJF9dWzBdDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAkT2JqZWN0UHJvcGVydGllc1skX10gPSAkUHJvcGVydGllc1skX10NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH0NCiAgICB0cnkgew0KICAgICAgICBOZXctT2JqZWN0IC1UeXBlTmFtZSBQU09iamVjdCAtUHJvcGVydHkgJE9iamVjdFByb3BlcnRpZXMNCiAgICB9DQogICAgY2F0Y2ggew0KICAgICAgICBXcml0ZS1XYXJuaW5nICJbQ29udmVydC1MREFQUHJvcGVydHldIEVycm9yIHBhcnNpbmcgTERBUCBwcm9wZXJ0aWVzIDogJF8iDQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIEdldC1Eb21haW4gew0KPCMNCi5TWU5PUFNJUw0KUmV0dXJucyB0aGUgZG9tYWluIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgKG9yIHNwZWNpZmllZCkgZG9tYWluLg0KQXV0aG9yOiBXaWxsIFNjaHJvZWRlciAoQGhhcm1qMHkpICANCkxpY2Vuc2U6IEJTRCAzLUNsYXVzZSAgDQpSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IE5vbmUgIA0KLkRFU0NSSVBUSU9ODQpSZXR1cm5zIGEgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Eb21haW4gb2JqZWN0IGZvciB0aGUgY3VycmVudA0KZG9tYWluIG9yIHRoZSBkb21haW4gc3BlY2lmaWVkIHdpdGggLURvbWFpbiBYLg0KLlBBUkFNRVRFUiBEb21haW4NClNwZWNpZmllcyB0aGUgZG9tYWluIG5hbWUgdG8gcXVlcnkgZm9yLCBkZWZhdWx0cyB0byB0aGUgY3VycmVudCBkb21haW4uDQouUEFSQU1FVEVSIENyZWRlbnRpYWwNCkEgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdIG9iamVjdCBvZiBhbHRlcm5hdGUgY3JlZGVudGlhbHMNCmZvciBjb25uZWN0aW9uIHRvIHRoZSB0YXJnZXQgZG9tYWluLg0KLkVYQU1QTEUNCkdldC1Eb21haW4gLURvbWFpbiB0ZXN0bGFiLmxvY2FsDQouRVhBTVBMRQ0KJFNlY1Bhc3N3b3JkID0gQ29udmVydFRvLVNlY3VyZVN0cmluZyAnUGFzc3dvcmQxMjMhJyAtQXNQbGFpblRleHQgLUZvcmNlDQokQ3JlZCA9IE5ldy1PYmplY3QgU3lzdGVtLk1hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWwoJ1RFU1RMQUJcZGZtLmEnLCAkU2VjUGFzc3dvcmQpDQpHZXQtRG9tYWluIC1DcmVkZW50aWFsICRDcmVkDQouT1VUUFVUUw0KU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Eb21haW4NCkEgY29tcGxleCAuTkVUIGRvbWFpbiBvYmplY3QuDQouTElOSw0KaHR0cDovL3NvY2lhbC50ZWNobmV0Lm1pY3Jvc29mdC5jb20vRm9ydW1zL3NjcmlwdGNlbnRlci9lbi1VUy8wYzViM2Y4My1lNTI4LTRkNDktOTJhNC1kZWUzMWY0YjQ4MWMvZmluZGluZy10aGUtZG4tb2YtdGhlLXRoZS1kb21haW4td2l0aG91dC1hZG1vZHVsZS1pbi1wb3dlcnNoZWxsP2ZvcnVtPUlUQ0cNCiM+DQoNCiAgICBbT3V0cHV0VHlwZShbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Eb21haW5dKV0NCiAgICBbQ21kbGV0QmluZGluZygpXQ0KICAgIFBhcmFtKA0KICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgVmFsdWVGcm9tUGlwZWxpbmUgPSAkVHJ1ZSldDQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldDQogICAgICAgIFtTdHJpbmddDQogICAgICAgICREb21haW4sDQoNCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdDQogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uQ3JlZGVudGlhbEF0dHJpYnV0ZSgpXQ0KICAgICAgICAkQ3JlZGVudGlhbCA9IFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXTo6RW1wdHkNCiAgICApDQoNCiAgICBQUk9DRVNTIHsNCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQ3JlZGVudGlhbCddKSB7DQoNCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJ1tHZXQtRG9tYWluXSBVc2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMgZm9yIEdldC1Eb21haW4nDQoNCiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RvbWFpbiddKSB7DQogICAgICAgICAgICAgICAgJFRhcmdldERvbWFpbiA9ICREb21haW4NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICMgaWYgbm8gZG9tYWluIGlzIHN1cHBsaWVkLCBleHRyYWN0IHRoZSBsb2dvbiBkb21haW4gZnJvbSB0aGUgUFNDcmVkZW50aWFsIHBhc3NlZA0KICAgICAgICAgICAgICAgICRUYXJnZXREb21haW4gPSAkQ3JlZGVudGlhbC5HZXROZXR3b3JrQ3JlZGVudGlhbCgpLkRvbWFpbg0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIltHZXQtRG9tYWluXSBFeHRyYWN0ZWQgZG9tYWluICckVGFyZ2V0RG9tYWluJyBmcm9tIC1DcmVkZW50aWFsIg0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkRG9tYWluQ29udGV4dCA9IE5ldy1PYmplY3QgU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5EaXJlY3RvcnlDb250ZXh0KCdEb21haW4nLCAkVGFyZ2V0RG9tYWluLCAkQ3JlZGVudGlhbC5Vc2VyTmFtZSwgJENyZWRlbnRpYWwuR2V0TmV0d29ya0NyZWRlbnRpYWwoKS5QYXNzd29yZCkNCg0KICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICBbU3lzdGVtLkRpcmVjdG9yeVNlcnZpY2VzLkFjdGl2ZURpcmVjdG9yeS5Eb21haW5dOjpHZXREb21haW4oJERvbWFpbkNvbnRleHQpDQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCB7DQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0dldC1Eb21haW5dIFRoZSBzcGVjaWZpZWQgZG9tYWluICckVGFyZ2V0RG9tYWluJyBkb2VzIG5vdCBleGlzdCwgY291bGQgbm90IGJlIGNvbnRhY3RlZCwgdGhlcmUgaXNuJ3QgYW4gZXhpc3RpbmcgdHJ1c3QsIG9yIHRoZSBzcGVjaWZpZWQgY3JlZGVudGlhbHMgYXJlIGludmFsaWQ6ICRfIg0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIGVsc2VpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEb21haW4nXSkgew0KICAgICAgICAgICAgJERvbWFpbkNvbnRleHQgPSBOZXctT2JqZWN0IFN5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRGlyZWN0b3J5Q29udGV4dCgnRG9tYWluJywgJERvbWFpbikNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5BY3RpdmVEaXJlY3RvcnkuRG9tYWluXTo6R2V0RG9tYWluKCREb21haW5Db250ZXh0KQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggew0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIltHZXQtRG9tYWluXSBUaGUgc3BlY2lmaWVkIGRvbWFpbiAnJERvbWFpbicgZG9lcyBub3QgZXhpc3QsIGNvdWxkIG5vdCBiZSBjb250YWN0ZWQsIG9yIHRoZXJlIGlzbid0IGFuIGV4aXN0aW5nIHRydXN0IDogJF8iDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgIFtTeXN0ZW0uRGlyZWN0b3J5U2VydmljZXMuQWN0aXZlRGlyZWN0b3J5LkRvbWFpbl06OkdldEN1cnJlbnREb21haW4oKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgY2F0Y2ggew0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIltHZXQtRG9tYWluXSBFcnJvciByZXRyaWV2aW5nIHRoZSBjdXJyZW50IGRvbWFpbjogJF8iDQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9DQp9DQoNCg0KDQpmdW5jdGlvbiBHZXQtRG9tYWluU1BOVGlja2V0IHsNCjwjDQouU1lOT1BTSVMNCg0KUmVxdWVzdCB0aGUga2VyYmVyb3MgdGlja2V0IGZvciBhIHNwZWNpZmllZCBzZXJ2aWNlIHByaW5jaXBhbCBuYW1lIChTUE4pLg0KDQpBdXRob3I6IG1hY2hvc2VjLCBXaWxsIFNjaHJvZWRlciAoQGhhcm1qMHkpICANCkxpY2Vuc2U6IEJTRCAzLUNsYXVzZSAgDQpSZXF1aXJlZCBEZXBlbmRlbmNpZXM6IEludm9rZS1Vc2VySW1wZXJzb25hdGlvbiwgSW52b2tlLVJldmVydFRvU2VsZiAgDQoNCi5ERVNDUklQVElPTg0KDQpUaGlzIGZ1bmN0aW9uIHdpbGwgZWl0aGVyIHRha2Ugb25lL21vcmUgU1BOIHN0cmluZ3MsIG9yIG9uZS9tb3JlIFBvd2VyVmlldy5Vc2VyIG9iamVjdHMNCih0aGUgb3V0cHV0IGZyb20gR2V0LURvbWFpblVzZXIpIGFuZCB3aWxsIHJlcXVlc3QgYSBrZXJiZXJvcyB0aWNrZXQgZm9yIHRoZSBnaXZlbiBTUE4NCnVzaW5nIFN5c3RlbS5JZGVudGl0eU1vZGVsLlRva2Vucy5LZXJiZXJvc1JlcXVlc3RvclNlY3VyaXR5VG9rZW4uIFRoZSBlbmNyeXB0ZWQNCnBvcnRpb24gb2YgdGhlIHRpY2tldCBpcyB0aGVuIGV4dHJhY3RlZCBhbmQgb3V0cHV0IGluIGVpdGhlciBjcmFja2FibGUgSm9obiBvciBIYXNoY2F0DQpmb3JtYXQgKGRlYWZ1bHQgb2YgSm9obikuDQoNCi5QQVJBTUVURVIgU1BODQoNClNwZWNpZmllcyB0aGUgc2VydmljZSBwcmluY2lwYWwgbmFtZSB0byByZXF1ZXN0IHRoZSB0aWNrZXQgZm9yLg0KDQouUEFSQU1FVEVSIFVzZXINCg0KU3BlY2lmaWVzIGEgUG93ZXJWaWV3LlVzZXIgb2JqZWN0IChyZXN1bHQgb2YgR2V0LURvbWFpblVzZXIpIHRvIHJlcXVlc3QgdGhlIHRpY2tldCBmb3IuDQoNCi5QQVJBTUVURVIgT3V0cHV0Rm9ybWF0DQoNCkVpdGhlciAnSm9obicgZm9yIEpvaG4gdGhlIFJpcHBlciBzdHlsZSBoYXNoIGZvcm1hdHRpbmcsIG9yICdIYXNoY2F0JyBmb3IgSGFzaGNhdCBmb3JtYXQuDQpEZWZhdWx0cyB0byAnSm9obicuDQoNCi5QQVJBTUVURVIgQ3JlZGVudGlhbA0KDQpBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzDQpmb3IgY29ubmVjdGlvbiB0byB0aGUgcmVtb3RlIGRvbWFpbiB1c2luZyBJbnZva2UtVXNlckltcGVyc29uYXRpb24uDQoNCi5QQVJBTUVURVIgRGVsYXkNCg0KU3BlY2lmaWVzIHRoZSBkZWxheSBpbiBzZWNvbmRzIGJldHdlZW4gdGlja2V0IHJlcXVlc3RzLg0KDQouUEFSQU1FVEVSIEppdHRlcg0KDQpTcGVjaWZpZXMgdGhlIGppdHRlciAoMC0xLjApIHRvIGFwcGx5IHRvIGFueSBzcGVjaWZpZWQgLURlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zDQoNCi5FWEFNUExFDQoNCkdldC1Eb21haW5TUE5UaWNrZXQgLVNQTiAiSFRUUC93ZWIudGVzdGxhYi5sb2NhbCINCg0KUmVxdWVzdCBhIGtlcmJlcm9zIHNlcnZpY2UgdGlja2V0IGZvciB0aGUgc3BlY2lmaWVkIFNQTi4NCg0KLkVYQU1QTEUNCg0KIkhUVFAvd2ViMS50ZXN0bGFiLmxvY2FsIiwiSFRUUC93ZWIyLnRlc3RsYWIubG9jYWwiIHwgR2V0LURvbWFpblNQTlRpY2tldA0KDQpSZXF1ZXN0IGtlcmJlcm9zIHNlcnZpY2UgdGlja2V0cyBmb3IgYWxsIFNQTnMgcGFzc2VkIG9uIHRoZSBwaXBlbGluZS4NCg0KLkVYQU1QTEUNCg0KR2V0LURvbWFpblVzZXIgLVNQTiB8IEdldC1Eb21haW5TUE5UaWNrZXQgLU91dHB1dEZvcm1hdCBIYXNoY2F0DQoNClJlcXVlc3Qga2VyYmVyb3Mgc2VydmljZSB0aWNrZXRzIGZvciBhbGwgdXNlcnMgd2l0aCBub24tbnVsbCBTUE5zIGFuZCBvdXRwdXQgaW4gSGFzaGNhdCBmb3JtYXQuDQoNCi5JTlBVVFMNCg0KU3RyaW5nDQoNCkFjY2VwdHMgb25lIG9yIG1vcmUgU1BOIHN0cmluZ3Mgb24gdGhlIHBpcGVsaW5lIHdpdGggdGhlIFJhd1NQTiBwYXJhbWV0ZXIgc2V0Lg0KDQouSU5QVVRTDQoNClBvd2VyVmlldy5Vc2VyDQoNCkFjY2VwdHMgb25lIG9yIG1vcmUgUG93ZXJWaWV3LlVzZXIgb2JqZWN0cyBvbiB0aGUgcGlwZWxpbmUgd2l0aCB0aGUgVXNlciBwYXJhbWV0ZXIgc2V0Lg0KDQouT1VUUFVUUw0KDQpQb3dlclZpZXcuU1BOVGlja2V0DQoNCk91dHB1dHMgYSBjdXN0b20gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIFNhbUFjY291bnROYW1lLCBTZXJ2aWNlUHJpbmNpcGFsTmFtZSwgYW5kIGVuY3J5cHRlZCB0aWNrZXQgc2VjdGlvbi4NCiM+DQoNCiAgICBbT3V0cHV0VHlwZSgnUG93ZXJWaWV3LlNQTlRpY2tldCcpXQ0KICAgIFtDbWRsZXRCaW5kaW5nKERlZmF1bHRQYXJhbWV0ZXJTZXROYW1lID0gJ1Jhd1NQTicpXQ0KICAgIFBhcmFtICgNCiAgICAgICAgW1BhcmFtZXRlcihQb3NpdGlvbiA9IDAsIFBhcmFtZXRlclNldE5hbWUgPSAnUmF3U1BOJywgTWFuZGF0b3J5ID0gJFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lID0gJFRydWUpXQ0KICAgICAgICBbVmFsaWRhdGVQYXR0ZXJuKCcuKi8uKicpXQ0KICAgICAgICBbQWxpYXMoJ1NlcnZpY2VQcmluY2lwYWxOYW1lJyldDQogICAgICAgIFtTdHJpbmdbXV0NCiAgICAgICAgJFNQTiwNCg0KICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgUGFyYW1ldGVyU2V0TmFtZSA9ICdVc2VyJywgTWFuZGF0b3J5ID0gJFRydWUsIFZhbHVlRnJvbVBpcGVsaW5lID0gJFRydWUpXQ0KICAgICAgICBbVmFsaWRhdGVTY3JpcHQoeyAkXy5QU09iamVjdC5UeXBlTmFtZXNbMF0gLWVxICdQb3dlclZpZXcuVXNlcicgfSldDQogICAgICAgIFtPYmplY3RbXV0NCiAgICAgICAgJFVzZXIsDQoNCiAgICAgICAgW1ZhbGlkYXRlU2V0KCdKb2huJywgJ0hhc2hjYXQnKV0NCiAgICAgICAgW0FsaWFzKCdGb3JtYXQnKV0NCiAgICAgICAgW1N0cmluZ10NCiAgICAgICAgJE91dHB1dEZvcm1hdCA9ICdKb2huJywNCg0KICAgICAgICBbVmFsaWRhdGVSYW5nZSgwLDEwMDAwKV0NCiAgICAgICAgW0ludF0NCiAgICAgICAgJERlbGF5ID0gMCwNCg0KICAgICAgICBbVmFsaWRhdGVSYW5nZSgwLjAsIDEuMCldDQogICAgICAgIFtEb3VibGVdDQogICAgICAgICRKaXR0ZXIgPSAuMywNCg0KICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0NCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5DcmVkZW50aWFsQXR0cmlidXRlKCldDQogICAgICAgICRDcmVkZW50aWFsID0gW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdOjpFbXB0eQ0KICAgICkNCg0KICAgIEJFR0lOIHsNCiAgICAgICAgJE51bGwgPSBbUmVmbGVjdGlvbi5Bc3NlbWJseV06OkxvYWRXaXRoUGFydGlhbE5hbWUoJ1N5c3RlbS5JZGVudGl0eU1vZGVsJykNCg0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydDcmVkZW50aWFsJ10pIHsNCiAgICAgICAgICAgICRMb2dvblRva2VuID0gSW52b2tlLVVzZXJJbXBlcnNvbmF0aW9uIC1DcmVkZW50aWFsICRDcmVkZW50aWFsDQogICAgICAgIH0NCiAgICB9DQoNCiAgICBQUk9DRVNTIHsNCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snVXNlciddKSB7DQogICAgICAgICAgICAkVGFyZ2V0T2JqZWN0ID0gJFVzZXINCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICRUYXJnZXRPYmplY3QgPSAkU1BODQogICAgICAgIH0NCgkNCgkkUmFuZE5vID0gTmV3LU9iamVjdCBTeXN0ZW0uUmFuZG9tDQoNCiAgICAgICAgRm9yRWFjaCAoJE9iamVjdCBpbiAkVGFyZ2V0T2JqZWN0KSB7DQoNCiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1VzZXInXSkgew0KICAgICAgICAgICAgICAgICRVc2VyU1BOID0gJE9iamVjdC5TZXJ2aWNlUHJpbmNpcGFsTmFtZQ0KICAgICAgICAgICAgICAgICRTYW1BY2NvdW50TmFtZSA9ICRPYmplY3QuU2FtQWNjb3VudE5hbWUNCiAgICAgICAgICAgICAgICAkRGlzdGluZ3Vpc2hlZE5hbWUgPSAkT2JqZWN0LkRpc3Rpbmd1aXNoZWROYW1lDQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAkVXNlclNQTiA9ICRPYmplY3QNCiAgICAgICAgICAgICAgICAkU2FtQWNjb3VudE5hbWUgPSAnVU5LTk9XTicNCiAgICAgICAgICAgICAgICAkRGlzdGluZ3Vpc2hlZE5hbWUgPSAnVU5LTk9XTicNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgIyBpZiBhIHVzZXIgaGFzIG11bHRpcGxlIFNQTnMgd2Ugb25seSB0YWtlIHRoZSBmaXJzdCBvbmUgb3RoZXJ3aXNlIHRoZSBzZXJ2aWNlIHRpY2tldCByZXF1ZXN0IGZhaWxzIG1pc2VyYWJseSA6KSAtQHN0M3IzMGJ5dDMNCiAgICAgICAgICAgIGlmICgkVXNlclNQTiAtaXMgW1N5c3RlbS5EaXJlY3RvcnlTZXJ2aWNlcy5SZXN1bHRQcm9wZXJ0eVZhbHVlQ29sbGVjdGlvbl0pIHsNCiAgICAgICAgICAgICAgICAkVXNlclNQTiA9ICRVc2VyU1BOWzBdDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgJFRpY2tldCA9IE5ldy1PYmplY3QgU3lzdGVtLklkZW50aXR5TW9kZWwuVG9rZW5zLktlcmJlcm9zUmVxdWVzdG9yU2VjdXJpdHlUb2tlbiAtQXJndW1lbnRMaXN0ICRVc2VyU1BODQogICAgICAgICAgICB9DQogICAgICAgICAgICBjYXRjaCB7DQogICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiW0dldC1Eb21haW5TUE5UaWNrZXRdIEVycm9yIHJlcXVlc3RpbmcgdGlja2V0IGZvciBTUE4gJyRVc2VyU1BOJyBmcm9tIHVzZXIgJyREaXN0aW5ndWlzaGVkTmFtZScgOiAkXyINCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkVGlja2V0KSB7DQogICAgICAgICAgICAgICAgJFRpY2tldEJ5dGVTdHJlYW0gPSAkVGlja2V0LkdldFJlcXVlc3QoKQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCRUaWNrZXRCeXRlU3RyZWFtKSB7DQogICAgICAgICAgICAgICAgJE91dCA9IE5ldy1PYmplY3QgUFNPYmplY3QNCg0KICAgICAgICAgICAgICAgICRUaWNrZXRIZXhTdHJlYW0gPSBbU3lzdGVtLkJpdENvbnZlcnRlcl06OlRvU3RyaW5nKCRUaWNrZXRCeXRlU3RyZWFtKSAtcmVwbGFjZSAnLScNCg0KICAgICAgICAgICAgICAgICMgVGlja2V0SGV4U3RyZWFtID09IEdTUy1BUEkgRnJhbWUgKHNlZSBodHRwczovL3Rvb2xzLmlldGYub3JnL2h0bWwvcmZjNDEyMSNzZWN0aW9uLTQuMSkNCiAgICAgICAgICAgICAgICAjIE5vIGVhc3kgd2F5IHRvIHBhcnNlIEFTTjEsIHNvIHdlJ2xsIHRyeSBzb21lIGphbmt5IHJlZ2V4IHRvIHBhcnNlIHRoZSBlbWJlZGRlZCBLUkJfQVBfUkVRLlRpY2tldCBvYmplY3QNCiAgICAgICAgICAgICAgICBpZigkVGlja2V0SGV4U3RyZWFtIC1tYXRjaCAnYTM4Mi4uLi4zMDgyLi4uLkEwMDMwMjAxKD88RXR5cGVMZW4+Li4pQTEuezEsNH0uLi4uLi4uQTI4Mig/PENpcGhlclRleHRMZW4+Li4uLikuLi4uLi4uLig/PERhdGFUb0VuZD4uKyknKSB7DQogICAgICAgICAgICAgICAgICAgICRFdHlwZSA9IFtDb252ZXJ0XTo6VG9CeXRlKCAkTWF0Y2hlcy5FdHlwZUxlbiwgMTYgKQ0KICAgICAgICAgICAgICAgICAgICAkQ2lwaGVyVGV4dExlbiA9IFtDb252ZXJ0XTo6VG9VSW50MzIoJE1hdGNoZXMuQ2lwaGVyVGV4dExlbiwgMTYpLTQNCiAgICAgICAgICAgICAgICAgICAgJENpcGhlclRleHQgPSAkTWF0Y2hlcy5EYXRhVG9FbmQuU3Vic3RyaW5nKDAsJENpcGhlclRleHRMZW4qMikNCg0KICAgICAgICAgICAgICAgICAgICAjIE1ha2Ugc3VyZSB0aGUgbmV4dCBmaWVsZCBtYXRjaGVzIHRoZSBiZWdpbm5pbmcgb2YgdGhlIEtSQl9BUF9SRVEuQXV0aGVudGljYXRvciBvYmplY3QNCiAgICAgICAgICAgICAgICAgICAgaWYoJE1hdGNoZXMuRGF0YVRvRW5kLlN1YnN0cmluZygkQ2lwaGVyVGV4dExlbioyLCA0KSAtbmUgJ0E0ODInKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICdFcnJvciBwYXJzaW5nIGNpcGhlcnRleHQgZm9yIHRoZSBTUE4gICQoJFRpY2tldC5TZXJ2aWNlUHJpbmNpcGFsTmFtZSkuIFVzZSB0aGUgVGlja2V0Qnl0ZUhleFN0cmVhbSBmaWVsZCBhbmQgZXh0cmFjdCB0aGUgaGFzaCBvZmZsaW5lIHdpdGggR2V0LUtlcmJlcm9hc3RIYXNoRnJvbUFQUmVxIicNCiAgICAgICAgICAgICAgICAgICAgICAgICRIYXNoID0gJG51bGwNCiAgICAgICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVGlja2V0Qnl0ZUhleFN0cmVhbScgKFtCaXRjb252ZXJ0ZXJdOjpUb1N0cmluZygkVGlja2V0Qnl0ZVN0cmVhbSkuUmVwbGFjZSgnLScsJycpKQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJEhhc2ggPSAiJCgkQ2lwaGVyVGV4dC5TdWJzdHJpbmcoMCwzMikpYCQkKCRDaXBoZXJUZXh0LlN1YnN0cmluZygzMikpIg0KICAgICAgICAgICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdUaWNrZXRCeXRlSGV4U3RyZWFtJyAkbnVsbA0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtV2FybmluZyAiVW5hYmxlIHRvIHBhcnNlIHRpY2tldCBzdHJ1Y3R1cmUgZm9yIHRoZSBTUE4gICQoJFRpY2tldC5TZXJ2aWNlUHJpbmNpcGFsTmFtZSkuIFVzZSB0aGUgVGlja2V0Qnl0ZUhleFN0cmVhbSBmaWVsZCBhbmQgZXh0cmFjdCB0aGUgaGFzaCBvZmZsaW5lIHdpdGggR2V0LUtlcmJlcm9hc3RIYXNoRnJvbUFQUmVxIg0KICAgICAgICAgICAgICAgICAgICAkSGFzaCA9ICRudWxsDQogICAgICAgICAgICAgICAgICAgICRPdXQgfCBBZGQtTWVtYmVyIE5vdGVwcm9wZXJ0eSAnVGlja2V0Qnl0ZUhleFN0cmVhbScgKFtCaXRjb252ZXJ0ZXJdOjpUb1N0cmluZygkVGlja2V0Qnl0ZVN0cmVhbSkuUmVwbGFjZSgnLScsJycpKQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmKCRIYXNoKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkT3V0cHV0Rm9ybWF0IC1tYXRjaCAnSm9obicpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRIYXNoRm9ybWF0ID0gImAka3JiNXRnc2AkJCgkVGlja2V0LlNlcnZpY2VQcmluY2lwYWxOYW1lKTokSGFzaCINCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkRGlzdGluZ3Vpc2hlZE5hbWUgLW5lICdVTktOT1dOJykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJERpc3Rpbmd1aXNoZWROYW1lLlN1YlN0cmluZygkRGlzdGluZ3Vpc2hlZE5hbWUuSW5kZXhPZignREM9JykpIC1yZXBsYWNlICdEQz0nLCcnIC1yZXBsYWNlICcsJywnLicNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICRVc2VyRG9tYWluID0gJ1VOS05PV04nDQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICMgaGFzaGNhdCBvdXRwdXQgZm9ybWF0DQogICAgICAgICAgICAgICAgICAgICAgICAkSGFzaEZvcm1hdCA9ICJgJGtyYjV0Z3NgJCQoJEV0eXBlKWAkKiRTYW1BY2NvdW50TmFtZWAkJFVzZXJEb21haW5gJCQoJFRpY2tldC5TZXJ2aWNlUHJpbmNpcGFsTmFtZSkqYCQkSGFzaCINCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAkT3V0IHwgQWRkLU1lbWJlciBOb3RlcHJvcGVydHkgJ0hhc2gnICRIYXNoRm9ybWF0DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTYW1BY2NvdW50TmFtZScgJFNhbUFjY291bnROYW1lDQogICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdEaXN0aW5ndWlzaGVkTmFtZScgJERpc3Rpbmd1aXNoZWROYW1lDQogICAgICAgICAgICAgICAgJE91dCB8IEFkZC1NZW1iZXIgTm90ZXByb3BlcnR5ICdTZXJ2aWNlUHJpbmNpcGFsTmFtZScgJFRpY2tldC5TZXJ2aWNlUHJpbmNpcGFsTmFtZQ0KICAgICAgICAgICAgICAgICRPdXQuUFNPYmplY3QuVHlwZU5hbWVzLkluc2VydCgwLCAnUG93ZXJWaWV3LlNQTlRpY2tldCcpDQogICAgICAgICAgICAgICAgV3JpdGUtT3V0cHV0ICRPdXQNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgICMgc2xlZXAgZm9yIG91ciBzZW1pLXJhbmRvbWl6ZWQgaW50ZXJ2YWwNCiAgICAgICAgICAgIFN0YXJ0LVNsZWVwIC1TZWNvbmRzICRSYW5kTm8uTmV4dCgoMS0kSml0dGVyKSokRGVsYXksICgxKyRKaXR0ZXIpKiREZWxheSkNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIEVORCB7DQogICAgICAgIGlmICgkTG9nb25Ub2tlbikgew0KICAgICAgICAgICAgSW52b2tlLVJldmVydFRvU2VsZiAtVG9rZW5IYW5kbGUgJExvZ29uVG9rZW4NCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gR2V0LURvbWFpblVzZXIgew0KPCMNCi5TWU5PUFNJUw0KUmV0dXJuIGFsbCB1c2VycyBvciBzcGVjaWZpYyB1c2VyIG9iamVjdHMgaW4gQUQuDQpBdXRob3I6IFdpbGwgU2Nocm9lZGVyIChAaGFybWoweSkgIA0KTGljZW5zZTogQlNEIDMtQ2xhdXNlICANClJlcXVpcmVkIERlcGVuZGVuY2llczogR2V0LURvbWFpblNlYXJjaGVyLCBDb252ZXJ0LUFETmFtZSwgQ29udmVydC1MREFQUHJvcGVydHkgIA0KLkRFU0NSSVBUSU9ODQpCdWlsZHMgYSBkaXJlY3Rvcnkgc2VhcmNoZXIgb2JqZWN0IHVzaW5nIEdldC1Eb21haW5TZWFyY2hlciwgYnVpbGRzIGEgY3VzdG9tDQpMREFQIGZpbHRlciBiYXNlZCBvbiB0YXJnZXRpbmcvZmlsdGVyIHBhcmFtZXRlcnMsIGFuZCBzZWFyY2hlcyBmb3IgYWxsIG9iamVjdHMNCm1hdGNoaW5nIHRoZSBjcml0ZXJpYS4gVG8gb25seSByZXR1cm4gc3BlY2lmaWMgcHJvcGVydGllcywgdXNlDQoiLVByb3BlcnRpZXMgc2FtYWNjb3VudG5hbWUsdXNuY2hhbmdlZCwuLi4iLiBCeSBkZWZhdWx0LCBhbGwgdXNlciBvYmplY3RzIGZvcg0KdGhlIGN1cnJlbnQgZG9tYWluIGFyZSByZXR1cm5lZC4NCi5QQVJBTUVURVIgSWRlbnRpdHkNCkEgU2FtQWNjb3VudE5hbWUgKGUuZy4gaGFybWoweSksIERpc3Rpbmd1aXNoZWROYW1lIChlLmcuIENOPWhhcm1qMHksQ049VXNlcnMsREM9dGVzdGxhYixEQz1sb2NhbCksDQpTSUQgKGUuZy4gUy0xLTUtMjEtODkwMTcxODU5LTM0MzM4MDkyNzktMzM2NjE5Njc1My0xMTA4KSwgb3IgR1VJRCAoZS5nLiA0YzQzNWRkNy1kYzU4LTRiMTQtOWE1ZS0xZmRiMGU4MGQyMDEpLg0KV2lsZGNhcmRzIGFjY2VwdGVkLiBBbHNvIGFjY2VwdHMgRE9NQUlOXHVzZXIgZm9ybWF0Lg0KLlBBUkFNRVRFUiBTUE4NClN3aXRjaC4gT25seSByZXR1cm4gdXNlciBvYmplY3RzIHdpdGggbm9uLW51bGwgc2VydmljZSBwcmluY2lwYWwgbmFtZXMuDQouUEFSQU1FVEVSIFVBQ0ZpbHRlcg0KRHluYW1pYyBwYXJhbWV0ZXIgdGhhdCBhY2NlcHRzIG9uZSBvciBtb3JlIHZhbHVlcyBmcm9tICRVQUNFbnVtLCBpbmNsdWRpbmcNCiJOT1RfWCIgbmVnYXRpb24gZm9ybXMuIFRvIHNlZSBhbGwgcG9zc2libGUgdmFsdWVzLCBydW4gJzB8Q29udmVydEZyb20tVUFDVmFsdWUgLVNob3dBbGwnLg0KLlBBUkFNRVRFUiBBZG1pbkNvdW50DQpTd2l0Y2guIFJldHVybiB1c2VycyB3aXRoICcoYWRtaW5Db3VudD0xKScgKG1lYW5pbmcgYXJlL3dlcmUgcHJpdmlsZWdlZCkuDQouUEFSQU1FVEVSIEFsbG93RGVsZWdhdGlvbg0KU3dpdGNoLiBSZXR1cm4gdXNlciBhY2NvdW50cyB0aGF0IGFyZSBub3QgbWFya2VkIGFzICdzZW5zaXRpdmUgYW5kIG5vdCBhbGxvd2VkIGZvciBkZWxlZ2F0aW9uJw0KLlBBUkFNRVRFUiBEaXNhbGxvd0RlbGVnYXRpb24NClN3aXRjaC4gUmV0dXJuIHVzZXIgYWNjb3VudHMgdGhhdCBhcmUgbWFya2VkIGFzICdzZW5zaXRpdmUgYW5kIG5vdCBhbGxvd2VkIGZvciBkZWxlZ2F0aW9uJw0KLlBBUkFNRVRFUiBUcnVzdGVkVG9BdXRoDQpTd2l0Y2guIFJldHVybiBjb21wdXRlciBvYmplY3RzIHRoYXQgYXJlIHRydXN0ZWQgdG8gYXV0aGVudGljYXRlIGZvciBvdGhlciBwcmluY2lwYWxzLg0KLlBBUkFNRVRFUiBQcmVhdXRoTm90UmVxdWlyZWQNClN3aXRjaC4gUmV0dXJuIHVzZXIgYWNjb3VudHMgd2l0aCAiRG8gbm90IHJlcXVpcmUgS2VyYmVyb3MgcHJlYXV0aGVudGljYXRpb24iIHNldC4NCi5QQVJBTUVURVIgRG9tYWluDQpTcGVjaWZpZXMgdGhlIGRvbWFpbiB0byB1c2UgZm9yIHRoZSBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLg0KLlBBUkFNRVRFUiBMREFQRmlsdGVyDQpTcGVjaWZpZXMgYW4gTERBUCBxdWVyeSBzdHJpbmcgdGhhdCBpcyB1c2VkIHRvIGZpbHRlciBBY3RpdmUgRGlyZWN0b3J5IG9iamVjdHMuDQouUEFSQU1FVEVSIFByb3BlcnRpZXMNClNwZWNpZmllcyB0aGUgcHJvcGVydGllcyBvZiB0aGUgb3V0cHV0IG9iamVjdCB0byByZXRyaWV2ZSBmcm9tIHRoZSBzZXJ2ZXIuDQouUEFSQU1FVEVSIFNlYXJjaEJhc2UNClRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIg0KVXNlZnVsIGZvciBPVSBxdWVyaWVzLg0KLlBBUkFNRVRFUiBTZXJ2ZXINClNwZWNpZmllcyBhbiBBY3RpdmUgRGlyZWN0b3J5IHNlcnZlciAoZG9tYWluIGNvbnRyb2xsZXIpIHRvIGJpbmQgdG8uDQouUEFSQU1FVEVSIFNlYXJjaFNjb3BlDQpTcGVjaWZpZXMgdGhlIHNjb3BlIHRvIHNlYXJjaCB1bmRlciwgQmFzZS9PbmVMZXZlbC9TdWJ0cmVlIChkZWZhdWx0IG9mIFN1YnRyZWUpLg0KLlBBUkFNRVRFUiBSZXN1bHRQYWdlU2l6ZQ0KU3BlY2lmaWVzIHRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4NCi5QQVJBTUVURVIgU2VydmVyVGltZUxpbWl0DQpTcGVjaWZpZXMgdGhlIG1heGltdW0gYW1vdW50IG9mIHRpbWUgdGhlIHNlcnZlciBzcGVuZHMgc2VhcmNoaW5nLiBEZWZhdWx0IG9mIDEyMCBzZWNvbmRzLg0KLlBBUkFNRVRFUiBTZWN1cml0eU1hc2tzDQpTcGVjaWZpZXMgYW4gb3B0aW9uIGZvciBleGFtaW5pbmcgc2VjdXJpdHkgaW5mb3JtYXRpb24gb2YgYSBkaXJlY3Rvcnkgb2JqZWN0Lg0KT25lIG9mICdEYWNsJywgJ0dyb3VwJywgJ05vbmUnLCAnT3duZXInLCAnU2FjbCcuDQouUEFSQU1FVEVSIFRvbWJzdG9uZQ0KU3dpdGNoLiBTcGVjaWZpZXMgdGhhdCB0aGUgc2VhcmNoZXIgc2hvdWxkIGFsc28gcmV0dXJuIGRlbGV0ZWQvdG9tYnN0b25lZCBvYmplY3RzLg0KLlBBUkFNRVRFUiBGaW5kT25lDQpPbmx5IHJldHVybiBvbmUgcmVzdWx0IG9iamVjdC4NCi5QQVJBTUVURVIgQ3JlZGVudGlhbA0KQSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF0gb2JqZWN0IG9mIGFsdGVybmF0ZSBjcmVkZW50aWFscw0KZm9yIGNvbm5lY3Rpb24gdG8gdGhlIHRhcmdldCBkb21haW4uDQouUEFSQU1FVEVSIFJhdw0KU3dpdGNoLiBSZXR1cm4gcmF3IHJlc3VsdHMgaW5zdGVhZCBvZiB0cmFuc2xhdGluZyB0aGUgZmllbGRzIGludG8gYSBjdXN0b20gUFNPYmplY3QuDQouRVhBTVBMRQ0KR2V0LURvbWFpblVzZXIgLURvbWFpbiB0ZXN0bGFiLmxvY2FsDQpSZXR1cm4gYWxsIHVzZXJzIGZvciB0aGUgdGVzdGxhYi5sb2NhbCBkb21haW4NCi5FWEFNUExFDQpHZXQtRG9tYWluVXNlciAiUy0xLTUtMjEtODkwMTcxODU5LTM0MzM4MDkyNzktMzM2NjE5Njc1My0xMTA4IiwiYWRtaW5pc3RyYXRvciINClJldHVybiB0aGUgdXNlciB3aXRoIHRoZSBnaXZlbiBTSUQsIGFzIHdlbGwgYXMgQWRtaW5pc3RyYXRvci4NCi5FWEFNUExFDQonUy0xLTUtMjEtODkwMTcxODU5LTM0MzM4MDkyNzktMzM2NjE5Njc1My0xMTE0JywgJ0NOPWRmbSxDTj1Vc2VycyxEQz10ZXN0bGFiLERDPWxvY2FsJywnNGM0MzVkZDctZGM1OC00YjE0LTlhNWUtMWZkYjBlODBkMjAxJywnYWRtaW5pc3RyYXRvcicgfCBHZXQtRG9tYWluVXNlciAtUHJvcGVydGllcyBzYW1hY2NvdW50bmFtZSxsYXN0bG9nb2ZmDQpsYXN0bG9nb2ZmICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1hY2NvdW50bmFtZQ0KLS0tLS0tLS0tLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLS0tLS0tLS0tLS0tLS0NCjEyLzMxLzE2MDAgNDowMDowMCBQTSAgICAgICAgICAgICAgICAgICAgICAgIGRmbS5hDQoxMi8zMS8xNjAwIDQ6MDA6MDAgUE0gICAgICAgICAgICAgICAgICAgICAgICBkZm0NCjEyLzMxLzE2MDAgNDowMDowMCBQTSAgICAgICAgICAgICAgICAgICAgICAgIGhhcm1qMHkNCjEyLzMxLzE2MDAgNDowMDowMCBQTSAgICAgICAgICAgICAgICAgICAgICAgIEFkbWluaXN0cmF0b3INCi5FWEFNUExFDQpHZXQtRG9tYWluVXNlciAtU2VhcmNoQmFzZSAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIiAtQWRtaW5Db3VudCAtQWxsb3dEZWxlZ2F0aW9uDQpTZWFyY2ggdGhlIHNwZWNpZmllZCBPVSBmb3IgcHJpdmlsZWdlZCB1c2VyIChBZG1pbkNvdW50ID0gMSkgdGhhdCBhbGxvdyBkZWxlZ2F0aW9uDQouRVhBTVBMRQ0KR2V0LURvbWFpblVzZXIgLUxEQVBGaWx0ZXIgJyghcHJpbWFyeWdyb3VwaWQ9NTEzKScgLVByb3BlcnRpZXMgc2FtYWNjb3VudG5hbWUsbGFzdGxvZ29uDQpTZWFyY2ggZm9yIHVzZXJzIHdpdGggYSBwcmltYXJ5IGdyb3VwIElEIG90aGVyIHRoYW4gNTEzICgnZG9tYWluIHVzZXJzJykgYW5kIG9ubHkgcmV0dXJuIHNhbWFjY291bnRuYW1lIGFuZCBsYXN0bG9nb24NCi5FWEFNUExFDQpHZXQtRG9tYWluVXNlciAtVUFDRmlsdGVyIERPTlRfUkVRX1BSRUFVVEgsTk9UX1BBU1NXT1JEX0VYUElSRUQNCkZpbmQgdXNlcnMgd2hvIGRvZXNuJ3QgcmVxdWlyZSBLZXJiZXJvcyBwcmVhdXRoZW50aWNhdGlvbiBhbmQgRE9OJ1QgaGF2ZSBhbiBleHBpcmVkIHBhc3N3b3JkLg0KLkVYQU1QTEUNCiRTZWNQYXNzd29yZCA9IENvbnZlcnRUby1TZWN1cmVTdHJpbmcgJ1Bhc3N3b3JkMTIzIScgLUFzUGxhaW5UZXh0IC1Gb3JjZQ0KJENyZWQgPSBOZXctT2JqZWN0IFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsKCdURVNUTEFCXGRmbS5hJywgJFNlY1Bhc3N3b3JkKQ0KR2V0LURvbWFpblVzZXIgLUNyZWRlbnRpYWwgJENyZWQNCi5FWEFNUExFDQpHZXQtRG9tYWluIHwgU2VsZWN0LU9iamVjdCAtRXhwYW5kIG5hbWUNCnRlc3RsYWIubG9jYWwNCkdldC1Eb21haW5Vc2VyIGRldlx1c2VyMSAtVmVyYm9zZSAtUHJvcGVydGllcyBkaXN0aW5ndWlzaGVkbmFtZQ0KVkVSQk9TRTogW0dldC1Eb21haW5TZWFyY2hlcl0gc2VhcmNoIHN0cmluZzogTERBUDovL1BSSU1BUlkudGVzdGxhYi5sb2NhbC9EQz10ZXN0bGFiLERDPWxvY2FsDQpWRVJCT1NFOiBbR2V0LURvbWFpblNlYXJjaGVyXSBzZWFyY2ggc3RyaW5nOiBMREFQOi8vUFJJTUFSWS50ZXN0bGFiLmxvY2FsL0RDPWRldixEQz10ZXN0bGFiLERDPWxvY2FsDQpWRVJCT1NFOiBbR2V0LURvbWFpblVzZXJdIGZpbHRlciBzdHJpbmc6ICgmKHNhbUFjY291bnRUeXBlPTgwNTMwNjM2OCkofChzYW1BY2NvdW50TmFtZT11c2VyMSkpKQ0KZGlzdGluZ3Vpc2hlZG5hbWUNCi0tLS0tLS0tLS0tLS0tLS0tDQpDTj11c2VyMSxDTj1Vc2VycyxEQz1kZXYsREM9dGVzdGxhYixEQz1sb2NhbA0KLklOUFVUUw0KU3RyaW5nDQouT1VUUFVUUw0KUG93ZXJWaWV3LlVzZXINCkN1c3RvbSBQU09iamVjdCB3aXRoIHRyYW5zbGF0ZWQgdXNlciBwcm9wZXJ0eSBmaWVsZHMuDQpQb3dlclZpZXcuVXNlci5SYXcNClRoZSByYXcgRGlyZWN0b3J5U2VydmljZXMuU2VhcmNoUmVzdWx0IG9iamVjdCwgaWYgLVJhdyBpcyBlbmFibGVkLg0KIz4NCg0KICAgIFtEaWFnbm9zdGljcy5Db2RlQW5hbHlzaXMuU3VwcHJlc3NNZXNzYWdlQXR0cmlidXRlKCdQU1VzZURlY2xhcmVkVmFyc01vcmVUaGFuQXNzaWdubWVudHMnLCAnJyldDQogICAgW0RpYWdub3N0aWNzLkNvZGVBbmFseXNpcy5TdXBwcmVzc01lc3NhZ2VBdHRyaWJ1dGUoJ1BTU2hvdWxkUHJvY2VzcycsICcnKV0NCiAgICBbT3V0cHV0VHlwZSgnUG93ZXJWaWV3LlVzZXInKV0NCiAgICBbT3V0cHV0VHlwZSgnUG93ZXJWaWV3LlVzZXIuUmF3JyldDQogICAgW0NtZGxldEJpbmRpbmcoRGVmYXVsdFBhcmFtZXRlclNldE5hbWUgPSAnQWxsb3dEZWxlZ2F0aW9uJyldDQogICAgUGFyYW0oDQogICAgICAgIFtQYXJhbWV0ZXIoUG9zaXRpb24gPSAwLCBWYWx1ZUZyb21QaXBlbGluZSA9ICRUcnVlLCBWYWx1ZUZyb21QaXBlbGluZUJ5UHJvcGVydHlOYW1lID0gJFRydWUpXQ0KICAgICAgICBbQWxpYXMoJ0Rpc3Rpbmd1aXNoZWROYW1lJywgJ1NhbUFjY291bnROYW1lJywgJ05hbWUnLCAnTWVtYmVyRGlzdGluZ3Vpc2hlZE5hbWUnLCAnTWVtYmVyTmFtZScpXQ0KICAgICAgICBbU3RyaW5nW11dDQogICAgICAgICRJZGVudGl0eSwNCg0KICAgICAgICBbU3dpdGNoXQ0KICAgICAgICAkU1BOLA0KDQogICAgICAgIFtTd2l0Y2hdDQogICAgICAgICRBZG1pbkNvdW50LA0KDQogICAgICAgIFtQYXJhbWV0ZXIoUGFyYW1ldGVyU2V0TmFtZSA9ICdBbGxvd0RlbGVnYXRpb24nKV0NCiAgICAgICAgW1N3aXRjaF0NCiAgICAgICAgJEFsbG93RGVsZWdhdGlvbiwNCg0KICAgICAgICBbUGFyYW1ldGVyKFBhcmFtZXRlclNldE5hbWUgPSAnRGlzYWxsb3dEZWxlZ2F0aW9uJyldDQogICAgICAgIFtTd2l0Y2hdDQogICAgICAgICREaXNhbGxvd0RlbGVnYXRpb24sDQoNCiAgICAgICAgW1N3aXRjaF0NCiAgICAgICAgJFRydXN0ZWRUb0F1dGgsDQoNCiAgICAgICAgW0FsaWFzKCdLZXJiZXJvc1ByZWF1dGhOb3RSZXF1aXJlZCcsICdOb1ByZWF1dGgnKV0NCiAgICAgICAgW1N3aXRjaF0NCiAgICAgICAgJFByZWF1dGhOb3RSZXF1aXJlZCwNCg0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQ0KICAgICAgICBbU3RyaW5nXQ0KICAgICAgICAkRG9tYWluLA0KDQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldDQogICAgICAgIFtBbGlhcygnRmlsdGVyJyldDQogICAgICAgIFtTdHJpbmddDQogICAgICAgICRMREFQRmlsdGVyLA0KDQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldDQogICAgICAgIFtTdHJpbmdbXV0NCiAgICAgICAgJFByb3BlcnRpZXMsDQoNCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0NCiAgICAgICAgW0FsaWFzKCdBRFNQYXRoJyldDQogICAgICAgIFtTdHJpbmddDQogICAgICAgICRTZWFyY2hCYXNlLA0KDQogICAgICAgIFtWYWxpZGF0ZU5vdE51bGxPckVtcHR5KCldDQogICAgICAgIFtBbGlhcygnRG9tYWluQ29udHJvbGxlcicpXQ0KICAgICAgICBbU3RyaW5nXQ0KICAgICAgICAkU2VydmVyLA0KDQogICAgICAgIFtWYWxpZGF0ZVNldCgnQmFzZScsICdPbmVMZXZlbCcsICdTdWJ0cmVlJyldDQogICAgICAgIFtTdHJpbmddDQogICAgICAgICRTZWFyY2hTY29wZSA9ICdTdWJ0cmVlJywNCg0KICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLCAxMDAwMCldDQogICAgICAgIFtJbnRdDQogICAgICAgICRSZXN1bHRQYWdlU2l6ZSA9IDIwMCwNCg0KICAgICAgICBbVmFsaWRhdGVSYW5nZSgxLCAxMDAwMCldDQogICAgICAgIFtJbnRdDQogICAgICAgICRTZXJ2ZXJUaW1lTGltaXQsDQoNCiAgICAgICAgW1ZhbGlkYXRlU2V0KCdEYWNsJywgJ0dyb3VwJywgJ05vbmUnLCAnT3duZXInLCAnU2FjbCcpXQ0KICAgICAgICBbU3RyaW5nXQ0KICAgICAgICAkU2VjdXJpdHlNYXNrcywNCg0KICAgICAgICBbU3dpdGNoXQ0KICAgICAgICAkVG9tYnN0b25lLA0KDQogICAgICAgIFtBbGlhcygnUmV0dXJuT25lJyldDQogICAgICAgIFtTd2l0Y2hdDQogICAgICAgICRGaW5kT25lLA0KDQogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXQ0KICAgICAgICBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLkNyZWRlbnRpYWxBdHRyaWJ1dGUoKV0NCiAgICAgICAgJENyZWRlbnRpYWwgPSBbTWFuYWdlbWVudC5BdXRvbWF0aW9uLlBTQ3JlZGVudGlhbF06OkVtcHR5LA0KDQogICAgICAgIFtTd2l0Y2hdDQogICAgICAgICRSYXcNCiAgICApDQo8Iw0KICAgIER5bmFtaWNQYXJhbSB7DQogICAgICAgICRVQUNWYWx1ZU5hbWVzID0gW0VudW1dOjpHZXROYW1lcygkVUFDRW51bSkNCiAgICAgICAgIyBhZGQgaW4gdGhlIG5lZ2F0aW9ucw0KICAgICAgICAkVUFDVmFsdWVOYW1lcyA9ICRVQUNWYWx1ZU5hbWVzIHwgRm9yRWFjaC1PYmplY3QgeyRfOyAiTk9UXyRfIn0NCiAgICAgICAgIyBjcmVhdGUgbmV3IGR5bmFtaWMgcGFyYW1ldGVyDQogICAgICAgIE5ldy1EeW5hbWljUGFyYW1ldGVyIC1OYW1lIFVBQ0ZpbHRlciAtVmFsaWRhdGVTZXQgJFVBQ1ZhbHVlTmFtZXMgLVR5cGUgKFthcnJheV0pDQogICAgfQ0KIz4NCiAgICBCRUdJTiB7DQogICAgICAgICRTZWFyY2hlckFyZ3VtZW50cyA9IEB7fQ0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydEb21haW4nXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ0RvbWFpbiddID0gJERvbWFpbiB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1Byb3BlcnRpZXMnXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ1Byb3BlcnRpZXMnXSA9ICRQcm9wZXJ0aWVzIH0NCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snU2VhcmNoQmFzZSddKSB7ICRTZWFyY2hlckFyZ3VtZW50c1snU2VhcmNoQmFzZSddID0gJFNlYXJjaEJhc2UgfQ0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZXJ2ZXInXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ1NlcnZlciddID0gJFNlcnZlciB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlYXJjaFNjb3BlJ10pIHsgJFNlYXJjaGVyQXJndW1lbnRzWydTZWFyY2hTY29wZSddID0gJFNlYXJjaFNjb3BlIH0NCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snUmVzdWx0UGFnZVNpemUnXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ1Jlc3VsdFBhZ2VTaXplJ10gPSAkUmVzdWx0UGFnZVNpemUgfQ0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydTZXJ2ZXJUaW1lTGltaXQnXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ1NlcnZlclRpbWVMaW1pdCddID0gJFNlcnZlclRpbWVMaW1pdCB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlY3VyaXR5TWFza3MnXSkgeyAkU2VhcmNoZXJBcmd1bWVudHNbJ1NlY3VyaXR5TWFza3MnXSA9ICRTZWN1cml0eU1hc2tzIH0NCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snVG9tYnN0b25lJ10pIHsgJFNlYXJjaGVyQXJndW1lbnRzWydUb21ic3RvbmUnXSA9ICRUb21ic3RvbmUgfQ0KICAgICAgICBpZiAoJFBTQm91bmRQYXJhbWV0ZXJzWydDcmVkZW50aWFsJ10pIHsgJFNlYXJjaGVyQXJndW1lbnRzWydDcmVkZW50aWFsJ10gPSAkQ3JlZGVudGlhbCB9DQogICAgICAgICRVc2VyU2VhcmNoZXIgPSBHZXQtRG9tYWluU2VhcmNoZXIgQFNlYXJjaGVyQXJndW1lbnRzDQogICAgfQ0KDQogICAgUFJPQ0VTUyB7DQogICAgICAgICNiaW5kIGR5bmFtaWMgcGFyYW1ldGVyIHRvIGEgZnJpZW5kbHkgdmFyaWFibGUNCiAgICAgICAgI2lmICgkUFNCb3VuZFBhcmFtZXRlcnMgLWFuZCAoJFBTQm91bmRQYXJhbWV0ZXJzLkNvdW50IC1uZSAwKSkgew0KICAgICAgICAjICAgIE5ldy1EeW5hbWljUGFyYW1ldGVyIC1DcmVhdGVWYXJpYWJsZXMgLUJvdW5kUGFyYW1ldGVycyAkUFNCb3VuZFBhcmFtZXRlcnMNCiAgICAgICAgI30NCg0KICAgICAgICBpZiAoJFVzZXJTZWFyY2hlcikgew0KICAgICAgICAgICAgJElkZW50aXR5RmlsdGVyID0gJycNCiAgICAgICAgICAgICRGaWx0ZXIgPSAnJw0KICAgICAgICAgICAgJElkZW50aXR5IHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7DQogICAgICAgICAgICAgICAgJElkZW50aXR5SW5zdGFuY2UgPSAkXy5SZXBsYWNlKCcoJywgJ1wyOCcpLlJlcGxhY2UoJyknLCAnXDI5JykNCiAgICAgICAgICAgICAgICBpZiAoJElkZW50aXR5SW5zdGFuY2UgLW1hdGNoICdeUy0xLScpIHsNCiAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5RmlsdGVyICs9ICIob2JqZWN0c2lkPSRJZGVudGl0eUluc3RhbmNlKSINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZWlmICgkSWRlbnRpdHlJbnN0YW5jZSAtbWF0Y2ggJ15DTj0nKSB7DQogICAgICAgICAgICAgICAgICAgICRJZGVudGl0eUZpbHRlciArPSAiKGRpc3Rpbmd1aXNoZWRuYW1lPSRJZGVudGl0eUluc3RhbmNlKSINCiAgICAgICAgICAgICAgICAgICAgaWYgKCgtbm90ICRQU0JvdW5kUGFyYW1ldGVyc1snRG9tYWluJ10pIC1hbmQgKC1ub3QgJFBTQm91bmRQYXJhbWV0ZXJzWydTZWFyY2hCYXNlJ10pKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAjIGlmIGEgLURvbWFpbiBpc24ndCBleHBsaWNpdGx5IHNldCwgZXh0cmFjdCB0aGUgb2JqZWN0IGRvbWFpbiBvdXQgb2YgdGhlIGRpc3Rpbmd1aXNoZWRuYW1lDQogICAgICAgICAgICAgICAgICAgICAgICAjICAgYW5kIHJlYnVpbGQgdGhlIGRvbWFpbiBzZWFyY2hlcg0KICAgICAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5RG9tYWluID0gJElkZW50aXR5SW5zdGFuY2UuU3ViU3RyaW5nKCRJZGVudGl0eUluc3RhbmNlLkluZGV4T2YoJ0RDPScpKSAtcmVwbGFjZSAnREM9JywnJyAtcmVwbGFjZSAnLCcsJy4nDQogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbR2V0LURvbWFpblVzZXJdIEV4dHJhY3RlZCBkb21haW4gJyRJZGVudGl0eURvbWFpbicgZnJvbSAnJElkZW50aXR5SW5zdGFuY2UnIg0KICAgICAgICAgICAgICAgICAgICAgICAgJFNlYXJjaGVyQXJndW1lbnRzWydEb21haW4nXSA9ICRJZGVudGl0eURvbWFpbg0KICAgICAgICAgICAgICAgICAgICAgICAgJFVzZXJTZWFyY2hlciA9IEdldC1Eb21haW5TZWFyY2hlciBAU2VhcmNoZXJBcmd1bWVudHMNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgtbm90ICRVc2VyU2VhcmNoZXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1XYXJuaW5nICJbR2V0LURvbWFpblVzZXJdIFVuYWJsZSB0byByZXRyaWV2ZSBkb21haW4gc2VhcmNoZXIgZm9yICckSWRlbnRpdHlEb21haW4nIg0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2VpZiAoJElkZW50aXR5SW5zdGFuY2UgLWltYXRjaCAnXlswLTlBLUZdezh9LShbMC05QS1GXXs0fS0pezN9WzAtOUEtRl17MTJ9JCcpIHsNCiAgICAgICAgICAgICAgICAgICAgJEd1aWRCeXRlU3RyaW5nID0gKChbR3VpZF0kSWRlbnRpdHlJbnN0YW5jZSkuVG9CeXRlQXJyYXkoKSB8IEZvckVhY2gtT2JqZWN0IHsgJ1wnICsgJF8uVG9TdHJpbmcoJ1gyJykgfSkgLWpvaW4gJycNCiAgICAgICAgICAgICAgICAgICAgJElkZW50aXR5RmlsdGVyICs9ICIob2JqZWN0Z3VpZD0kR3VpZEJ5dGVTdHJpbmcpIg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlaWYgKCRJZGVudGl0eUluc3RhbmNlLkNvbnRhaW5zKCdcJykpIHsNCiAgICAgICAgICAgICAgICAgICAgJENvbnZlcnRlZElkZW50aXR5SW5zdGFuY2UgPSAkSWRlbnRpdHlJbnN0YW5jZS5SZXBsYWNlKCdcMjgnLCAnKCcpLlJlcGxhY2UoJ1wyOScsICcpJykgfCBDb252ZXJ0LUFETmFtZSAtT3V0cHV0VHlwZSBDYW5vbmljYWwNCiAgICAgICAgICAgICAgICAgICAgaWYgKCRDb252ZXJ0ZWRJZGVudGl0eUluc3RhbmNlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkVXNlckRvbWFpbiA9ICRDb252ZXJ0ZWRJZGVudGl0eUluc3RhbmNlLlN1YlN0cmluZygwLCAkQ29udmVydGVkSWRlbnRpdHlJbnN0YW5jZS5JbmRleE9mKCcvJykpDQogICAgICAgICAgICAgICAgICAgICAgICAkVXNlck5hbWUgPSAkSWRlbnRpdHlJbnN0YW5jZS5TcGxpdCgnXCcpWzFdDQogICAgICAgICAgICAgICAgICAgICAgICAkSWRlbnRpdHlGaWx0ZXIgKz0gIihzYW1BY2NvdW50TmFtZT0kVXNlck5hbWUpIg0KICAgICAgICAgICAgICAgICAgICAgICAgJFNlYXJjaGVyQXJndW1lbnRzWydEb21haW4nXSA9ICRVc2VyRG9tYWluDQogICAgICAgICAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICJbR2V0LURvbWFpblVzZXJdIEV4dHJhY3RlZCBkb21haW4gJyRVc2VyRG9tYWluJyBmcm9tICckSWRlbnRpdHlJbnN0YW5jZSciDQogICAgICAgICAgICAgICAgICAgICAgICAkVXNlclNlYXJjaGVyID0gR2V0LURvbWFpblNlYXJjaGVyIEBTZWFyY2hlckFyZ3VtZW50cw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkSWRlbnRpdHlGaWx0ZXIgKz0gIihzYW1BY2NvdW50TmFtZT0kSWRlbnRpdHlJbnN0YW5jZSkiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAoJElkZW50aXR5RmlsdGVyIC1hbmQgKCRJZGVudGl0eUZpbHRlci5UcmltKCkgLW5lICcnKSApIHsNCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIofCRJZGVudGl0eUZpbHRlcikiDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NQTiddKSB7DQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAnW0dldC1Eb21haW5Vc2VyXSBTZWFyY2hpbmcgZm9yIG5vbi1udWxsIHNlcnZpY2UgcHJpbmNpcGFsIG5hbWVzJw0KICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gJyhzZXJ2aWNlUHJpbmNpcGFsTmFtZT0qKScNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0FsbG93RGVsZWdhdGlvbiddKSB7DQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAnW0dldC1Eb21haW5Vc2VyXSBTZWFyY2hpbmcgZm9yIHVzZXJzIHdobyBjYW4gYmUgZGVsZWdhdGVkJw0KICAgICAgICAgICAgICAgICMgbmVnYXRpb24gb2YgIkFjY291bnRzIHRoYXQgYXJlIHNlbnNpdGl2ZSBhbmQgbm90IHRydXN0ZWQgZm9yIGRlbGVnYXRpb24iDQogICAgICAgICAgICAgICAgJEZpbHRlciArPSAnKCEodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTEwNDg1NzQpKScNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0Rpc2FsbG93RGVsZWdhdGlvbiddKSB7DQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAnW0dldC1Eb21haW5Vc2VyXSBTZWFyY2hpbmcgZm9yIHVzZXJzIHdobyBhcmUgc2Vuc2l0aXZlIGFuZCBub3QgdHJ1c3RlZCBmb3IgZGVsZWdhdGlvbicNCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICcodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTEwNDg1NzQpJw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQWRtaW5Db3VudCddKSB7DQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAnW0dldC1Eb21haW5Vc2VyXSBTZWFyY2hpbmcgZm9yIGFkbWluQ291bnQ9MScNCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICcoYWRtaW5jb3VudD0xKScNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1RydXN0ZWRUb0F1dGgnXSkgew0KICAgICAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgJ1tHZXQtRG9tYWluVXNlcl0gU2VhcmNoaW5nIGZvciB1c2VycyB0aGF0IGFyZSB0cnVzdGVkIHRvIGF1dGhlbnRpY2F0ZSBmb3Igb3RoZXIgcHJpbmNpcGFscycNCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICcobXNkcy1hbGxvd2VkdG9kZWxlZ2F0ZXRvPSopJw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snUHJlYXV0aE5vdFJlcXVpcmVkJ10pIHsNCiAgICAgICAgICAgICAgICBXcml0ZS1WZXJib3NlICdbR2V0LURvbWFpblVzZXJdIFNlYXJjaGluZyBmb3IgdXNlciBhY2NvdW50cyB0aGF0IGRvIG5vdCByZXF1aXJlIGtlcmJlcm9zIHByZWF1dGhlbnRpY2F0ZScNCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICcodXNlckFjY291bnRDb250cm9sOjEuMi44NDAuMTEzNTU2LjEuNC44MDM6PTQxOTQzMDQpJw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snTERBUEZpbHRlciddKSB7DQogICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0dldC1Eb21haW5Vc2VyXSBVc2luZyBhZGRpdGlvbmFsIExEQVAgZmlsdGVyOiAkTERBUEZpbHRlciINCiAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIkTERBUEZpbHRlciINCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgIyBidWlsZCB0aGUgTERBUCBmaWx0ZXIgZm9yIHRoZSBkeW5hbWljIFVBQyBmaWx0ZXIgdmFsdWUNCiAgICAgICAgICAgICRVQUNGaWx0ZXIgfCBXaGVyZS1PYmplY3QgeyRffSB8IEZvckVhY2gtT2JqZWN0IHsNCiAgICAgICAgICAgICAgICBpZiAoJF8gLW1hdGNoICdOT1RfLionKSB7DQogICAgICAgICAgICAgICAgICAgICRVQUNGaWVsZCA9ICRfLlN1YnN0cmluZyg0KQ0KICAgICAgICAgICAgICAgICAgICAkVUFDVmFsdWUgPSBbSW50XSgkVUFDRW51bTo6JFVBQ0ZpZWxkKQ0KICAgICAgICAgICAgICAgICAgICAkRmlsdGVyICs9ICIoISh1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9JFVBQ1ZhbHVlKSkiDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAkVUFDVmFsdWUgPSBbSW50XSgkVUFDRW51bTo6JF8pDQogICAgICAgICAgICAgICAgICAgICRGaWx0ZXIgKz0gIih1c2VyQWNjb3VudENvbnRyb2w6MS4yLjg0MC4xMTM1NTYuMS40LjgwMzo9JFVBQ1ZhbHVlKSINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRVc2VyU2VhcmNoZXIuZmlsdGVyID0gIigmKHNhbUFjY291bnRUeXBlPTgwNTMwNjM2OCkkRmlsdGVyKSINCiAgICAgICAgICAgIFdyaXRlLVZlcmJvc2UgIltHZXQtRG9tYWluVXNlcl0gZmlsdGVyIHN0cmluZzogJCgkVXNlclNlYXJjaGVyLmZpbHRlcikiDQoNCiAgICAgICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0ZpbmRPbmUnXSkgeyAkUmVzdWx0cyA9ICRVc2VyU2VhcmNoZXIuRmluZE9uZSgpIH0NCiAgICAgICAgICAgIGVsc2UgeyAkUmVzdWx0cyA9ICRVc2VyU2VhcmNoZXIuRmluZEFsbCgpIH0NCiAgICAgICAgICAgICRSZXN1bHRzIHwgV2hlcmUtT2JqZWN0IHskX30gfCBGb3JFYWNoLU9iamVjdCB7DQogICAgICAgICAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snUmF3J10pIHsNCiAgICAgICAgICAgICAgICAgICAgIyByZXR1cm4gcmF3IHJlc3VsdCBvYmplY3RzDQogICAgICAgICAgICAgICAgICAgICRVc2VyID0gJF8NCiAgICAgICAgICAgICAgICAgICAgJFVzZXIuUFNPYmplY3QuVHlwZU5hbWVzLkluc2VydCgwLCAnUG93ZXJWaWV3LlVzZXIuUmF3JykNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRVc2VyID0gQ29udmVydC1MREFQUHJvcGVydHkgLVByb3BlcnRpZXMgJF8uUHJvcGVydGllcw0KICAgICAgICAgICAgICAgICAgICAkVXNlci5QU09iamVjdC5UeXBlTmFtZXMuSW5zZXJ0KDAsICdQb3dlclZpZXcuVXNlcicpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICRVc2VyDQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAoJFJlc3VsdHMpIHsNCiAgICAgICAgICAgICAgICB0cnkgeyAkUmVzdWx0cy5kaXNwb3NlKCkgfQ0KICAgICAgICAgICAgICAgIGNhdGNoIHsNCiAgICAgICAgICAgICAgICAgICAgV3JpdGUtVmVyYm9zZSAiW0dldC1Eb21haW5Vc2VyXSBFcnJvciBkaXNwb3Npbmcgb2YgdGhlIFJlc3VsdHMgb2JqZWN0OiAkXyINCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICAkVXNlclNlYXJjaGVyLmRpc3Bvc2UoKQ0KICAgICAgICB9DQogICAgfQ0KfQ0KDQoNCmZ1bmN0aW9uIEludm9rZS1LZXJiZXJvYXN0IHsNCjwjDQouU1lOT1BTSVMNClJlcXVlc3RzIHNlcnZpY2UgdGlja2V0cyBmb3Iga2VyYmVyb2FzdC1hYmxlIGFjY291bnRzIGFuZCByZXR1cm5zIGV4dHJhY3RlZCB0aWNrZXQgaGFzaGVzLg0KQXV0aG9yOiBXaWxsIFNjaHJvZWRlciAoQGhhcm1qMHkpLCBAbWFjaG9zZWMgIA0KTGljZW5zZTogQlNEIDMtQ2xhdXNlICANClJlcXVpcmVkIERlcGVuZGVuY2llczogSW52b2tlLVVzZXJJbXBlcnNvbmF0aW9uLCBJbnZva2UtUmV2ZXJ0VG9TZWxmLCBHZXQtRG9tYWluVXNlciwgR2V0LURvbWFpblNQTlRpY2tldCAgDQouREVTQ1JJUFRJT04NClVzZXMgR2V0LURvbWFpblVzZXIgdG8gcXVlcnkgZm9yIHVzZXIgYWNjb3VudHMgd2l0aCBub24tbnVsbCBzZXJ2aWNlIHByaW5jaXBsZQ0KbmFtZXMgKFNQTnMpIGFuZCB1c2VzIEdldC1TUE5UaWNrZXQgdG8gcmVxdWVzdC9leHRyYWN0IHRoZSBjcmFja2FibGUgdGlja2V0IGluZm9ybWF0aW9uLg0KVGhlIHRpY2tldCBmb3JtYXQgY2FuIGJlIHNwZWNpZmllZCB3aXRoIC1PdXRwdXRGb3JtYXQgPEpvaG4vSGFzaGNhdD4uDQouUEFSQU1FVEVSIElkZW50aXR5DQpBIFNhbUFjY291bnROYW1lIChlLmcuIGhhcm1qMHkpLCBEaXN0aW5ndWlzaGVkTmFtZSAoZS5nLiBDTj1oYXJtajB5LENOPVVzZXJzLERDPXRlc3RsYWIsREM9bG9jYWwpLA0KU0lEIChlLmcuIFMtMS01LTIxLTg5MDE3MTg1OS0zNDMzODA5Mjc5LTMzNjYxOTY3NTMtMTEwOCksIG9yIEdVSUQgKGUuZy4gNGM0MzVkZDctZGM1OC00YjE0LTlhNWUtMWZkYjBlODBkMjAxKS4NCldpbGRjYXJkcyBhY2NlcHRlZC4NCi5QQVJBTUVURVIgRG9tYWluDQpTcGVjaWZpZXMgdGhlIGRvbWFpbiB0byB1c2UgZm9yIHRoZSBxdWVyeSwgZGVmYXVsdHMgdG8gdGhlIGN1cnJlbnQgZG9tYWluLg0KLlBBUkFNRVRFUiBMREFQRmlsdGVyDQpTcGVjaWZpZXMgYW4gTERBUCBxdWVyeSBzdHJpbmcgdGhhdCBpcyB1c2VkIHRvIGZpbHRlciBBY3RpdmUgRGlyZWN0b3J5IG9iamVjdHMuDQouUEFSQU1FVEVSIFNlYXJjaEJhc2UNClRoZSBMREFQIHNvdXJjZSB0byBzZWFyY2ggdGhyb3VnaCwgZS5nLiAiTERBUDovL09VPXNlY3JldCxEQz10ZXN0bGFiLERDPWxvY2FsIg0KVXNlZnVsIGZvciBPVSBxdWVyaWVzLg0KLlBBUkFNRVRFUiBTZXJ2ZXINClNwZWNpZmllcyBhbiBBY3RpdmUgRGlyZWN0b3J5IHNlcnZlciAoZG9tYWluIGNvbnRyb2xsZXIpIHRvIGJpbmQgdG8uDQouUEFSQU1FVEVSIFNlYXJjaFNjb3BlDQpTcGVjaWZpZXMgdGhlIHNjb3BlIHRvIHNlYXJjaCB1bmRlciwgQmFzZS9PbmVMZXZlbC9TdWJ0cmVlIChkZWZhdWx0IG9mIFN1YnRyZWUpLg0KLlBBUkFNRVRFUiBSZXN1bHRQYWdlU2l6ZQ0KU3BlY2lmaWVzIHRoZSBQYWdlU2l6ZSB0byBzZXQgZm9yIHRoZSBMREFQIHNlYXJjaGVyIG9iamVjdC4NCi5QQVJBTUVURVIgU2VydmVyVGltZUxpbWl0DQpTcGVjaWZpZXMgdGhlIG1heGltdW0gYW1vdW50IG9mIHRpbWUgdGhlIHNlcnZlciBzcGVuZHMgc2VhcmNoaW5nLiBEZWZhdWx0IG9mIDEyMCBzZWNvbmRzLg0KLlBBUkFNRVRFUiBUb21ic3RvbmUNClN3aXRjaC4gU3BlY2lmaWVzIHRoYXQgdGhlIHNlYXJjaGVyIHNob3VsZCBhbHNvIHJldHVybiBkZWxldGVkL3RvbWJzdG9uZWQgb2JqZWN0cy4NCi5QQVJBTUVURVIgT3V0cHV0Rm9ybWF0DQpFaXRoZXIgJ0pvaG4nIGZvciBKb2huIHRoZSBSaXBwZXIgc3R5bGUgaGFzaCBmb3JtYXR0aW5nLCBvciAnSGFzaGNhdCcgZm9yIEhhc2hjYXQgZm9ybWF0Lg0KRGVmYXVsdHMgdG8gJ0pvaG4nLg0KLlBBUkFNRVRFUiBDcmVkZW50aWFsDQpBIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXSBvYmplY3Qgb2YgYWx0ZXJuYXRlIGNyZWRlbnRpYWxzDQpmb3IgY29ubmVjdGlvbiB0byB0aGUgdGFyZ2V0IGRvbWFpbi4NCi5QQVJBTUVURVIgRGVsYXkNClNwZWNpZmllcyB0aGUgZGVsYXkgaW4gc2Vjb25kcyBiZXR3ZWVuIHRpY2tldCByZXF1ZXN0cy4NCi5QQVJBTUVURVIgSml0dGVyDQpTcGVjaWZpZXMgdGhlIGppdHRlciAoMC0xLjApIHRvIGFwcGx5IHRvIGFueSBzcGVjaWZpZWQgLURlbGF5LCBkZWZhdWx0cyB0byArLy0gMC4zDQouRVhBTVBMRQ0KSW52b2tlLUtlcmJlcm9hc3QgfCBmbA0KS2VyYmVyb2FzdHMgYWxsIGZvdW5kIFNQTnMgZm9yIHRoZSBjdXJyZW50IGRvbWFpbi4NCi5FWEFNUExFDQpJbnZva2UtS2VyYmVyb2FzdCAtRG9tYWluIGRldi50ZXN0bGFiLmxvY2FsIC1PdXRwdXRGb3JtYXQgSGFzaENhdCB8IGZsDQpLZXJiZXJvYXN0cyBhbGwgZm91bmQgU1BOcyBmb3IgdGhlIHRlc3RsYWIubG9jYWwgZG9tYWluLCBvdXRwdXR0aW5nIHRvIEhhc2hDYXQNCmZvcm1hdCBpbnN0ZWFkIG9mIEpvaG4gKHRoZSBkZWZhdWx0KS4NCi5FWEFNUExFDQokU2VjUGFzc3dvcmQgPSBDb252ZXJ0VG8tU2VjdXJlU3RyaW5nICdQYXNzd29yZDEyMyEnIC1Bc1BsYWluVGV4dCAtb3JjZQ0KJENyZWQgPSBOZXctT2JqZWN0IFN5c3RlbS5NYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsKCdURVNUTEJcZGZtLmEnLCAkU2VjUGFzc3dvcmQpDQpJbnZva2UtS2VyYmVyb2FzdCAtQ3JlZGVudGlhbCAkQ3JlZCAtVmVyYm9zZSAtRG9tYWluIHRlc3RsYWIubG9jYWwgfCBmbA0KS2VyYmVyb2FzdHMgYWxsIGZvdW5kIFNQTnMgZm9yIHRoZSB0ZXN0bGFiLmxvY2FsIGRvbWFpbiB1c2luZyBhbHRlcm5hdGUgY3JlZGVudGlhbHMuDQouT1VUUFVUUw0KUG93ZXJWaWV3LlNQTlRpY2tldA0KT3V0cHV0cyBhIGN1c3RvbSBvYmplY3QgY29udGFpbmluZyB0aGUgU2FtQWNjb3VudE5hbWUsIFNlcnZpY2VQcmluY2lwYWxOYW1lLCBhbmQgZW5jcnlwdGVkIHRpY2tldCBzZWN0aW9uLg0KIz4NCg0KICAgIFtEaWFnbm9zdGljcy5Db2RlQW5hbHlzaXMuU3VwcHJlc3NNZXNzYWdlQXR0cmlidXRlKCdQU1Nob3VsZFByb2Nlc3MnLCAnJyldDQogICAgW091dHB1dFR5cGUoJ1Bvd2VyVmlldy5TUE5UaWNrZXQnKV0NCiAgICBbQ21kbGV0QmluZGluZygpXQ0KICAgIFBhcmFtKA0KICAgICAgICBbUGFyYW1ldGVyKFBvc2l0aW9uID0gMCwgVmFsdWVGcm9tUGlwZWxpbmUgPSAkVHJ1ZSwgVmFsdWVGcm9tUGlwZWxpbmVCeVByb3BlcnR5TmFtZSA9ICRUcnVlKV0NCiAgICAgICAgW0FsaWFzKCdEaXN0aW5ndWlzaGVkTmFtZScsICdTYW1BY2NvdW50TmFtZScsICdOYW1lJywgJ01lbWJlckRpc3Rpbmd1aXNoZWROYW1lJywgJ01lbWJlck5hbWUnKV0NCiAgICAgICAgW1N0cmluZ1tdXQ0KICAgICAgICAkSWRlbnRpdHksDQoNCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0NCiAgICAgICAgW1N0cmluZ10NCiAgICAgICAgJERvbWFpbiwNCg0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQ0KICAgICAgICBbQWxpYXMoJ0ZpbHRlcicpXQ0KICAgICAgICBbU3RyaW5nXQ0KICAgICAgICAkTERBUEZpbHRlciwNCg0KICAgICAgICBbVmFsaWRhdGVOb3ROdWxsT3JFbXB0eSgpXQ0KICAgICAgICBbQWxpYXMoJ0FEU1BhdGgnKV0NCiAgICAgICAgW1N0cmluZ10NCiAgICAgICAgJFNlYXJjaEJhc2UsDQoNCiAgICAgICAgW1ZhbGlkYXRlTm90TnVsbE9yRW1wdHkoKV0NCiAgICAgICAgW0FsaWFzKCdEb21haW5Db250cm9sbGVyJyldDQogICAgICAgIFtTdHJpbmddDQogICAgICAgICRTZXJ2ZXIsDQoNCiAgICAgICAgW1ZhbGlkYXRlU2V0KCdCYXNlJywgJ09uZUxldmVsJywgJ1N1YnRyZWUnKV0NCiAgICAgICAgW1N0cmluZ10NCiAgICAgICAgJFNlYXJjaFNjb3BlID0gJ1N1YnRyZWUnLA0KDQogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsIDEwMDAwKV0NCiAgICAgICAgW0ludF0NCiAgICAgICAgJFJlc3VsdFBhZ2VTaXplID0gMjAwLA0KDQogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDEsIDEwMDAwKV0NCiAgICAgICAgW0ludF0NCiAgICAgICAgJFNlcnZlclRpbWVMaW1pdCwNCg0KICAgICAgICBbU3dpdGNoXQ0KICAgICAgICAkVG9tYnN0b25lLA0KDQogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDAsMTAwMDApXQ0KICAgICAgICBbSW50XQ0KICAgICAgICAkRGVsYXkgPSAwLA0KDQogICAgICAgIFtWYWxpZGF0ZVJhbmdlKDAuMCwgMS4wKV0NCiAgICAgICAgW0RvdWJsZV0NCiAgICAgICAgJEppdHRlciA9IC4zLA0KDQogICAgICAgIFtWYWxpZGF0ZVNldCgnSm9obicsICdIYXNoY2F0JyldDQogICAgICAgIFtBbGlhcygnRm9ybWF0JyldDQogICAgICAgIFtTdHJpbmddDQogICAgICAgICRPdXRwdXRGb3JtYXQgPSAnSm9obicsDQoNCiAgICAgICAgW01hbmFnZW1lbnQuQXV0b21hdGlvbi5QU0NyZWRlbnRpYWxdDQogICAgICAgIFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uQ3JlZGVudGlhbEF0dHJpYnV0ZSgpXQ0KICAgICAgICAkQ3JlZGVudGlhbCA9IFtNYW5hZ2VtZW50LkF1dG9tYXRpb24uUFNDcmVkZW50aWFsXTo6RW1wdHkNCiAgICApDQoNCiAgICBCRUdJTiB7DQogICAgICAgICRVc2VyU2VhcmNoZXJBcmd1bWVudHMgPSBAew0KICAgICAgICAgICAgJ1NQTicgPSAkVHJ1ZQ0KICAgICAgICAgICAgJ1Byb3BlcnRpZXMnID0gJ3NhbWFjY291bnRuYW1lLGRpc3Rpbmd1aXNoZWRuYW1lLHNlcnZpY2VwcmluY2lwYWxuYW1lJw0KICAgICAgICB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0RvbWFpbiddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ0RvbWFpbiddID0gJERvbWFpbiB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0xEQVBGaWx0ZXInXSkgeyAkVXNlclNlYXJjaGVyQXJndW1lbnRzWydMREFQRmlsdGVyJ10gPSAkTERBUEZpbHRlciB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlYXJjaEJhc2UnXSkgeyAkVXNlclNlYXJjaGVyQXJndW1lbnRzWydTZWFyY2hCYXNlJ10gPSAkU2VhcmNoQmFzZSB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlcnZlciddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ1NlcnZlciddID0gJFNlcnZlciB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlYXJjaFNjb3BlJ10pIHsgJFVzZXJTZWFyY2hlckFyZ3VtZW50c1snU2VhcmNoU2NvcGUnXSA9ICRTZWFyY2hTY29wZSB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1Jlc3VsdFBhZ2VTaXplJ10pIHsgJFVzZXJTZWFyY2hlckFyZ3VtZW50c1snUmVzdWx0UGFnZVNpemUnXSA9ICRSZXN1bHRQYWdlU2l6ZSB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1NlcnZlclRpbWVMaW1pdCddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ1NlcnZlclRpbWVMaW1pdCddID0gJFNlcnZlclRpbWVMaW1pdCB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ1RvbWJzdG9uZSddKSB7ICRVc2VyU2VhcmNoZXJBcmd1bWVudHNbJ1RvbWJzdG9uZSddID0gJFRvbWJzdG9uZSB9DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0NyZWRlbnRpYWwnXSkgeyAkVXNlclNlYXJjaGVyQXJndW1lbnRzWydDcmVkZW50aWFsJ10gPSAkQ3JlZGVudGlhbCB9DQoNCiAgICAgICAgaWYgKCRQU0JvdW5kUGFyYW1ldGVyc1snQ3JlZGVudGlhbCddKSB7DQogICAgICAgICAgICAkTG9nb25Ub2tlbiA9IEludm9rZS1Vc2VySW1wZXJzb25hdGlvbiAtQ3JlZGVudGlhbCAkQ3JlZGVudGlhbA0KICAgICAgICB9DQogICAgfQ0KDQogICAgUFJPQ0VTUyB7DQogICAgICAgIGlmICgkUFNCb3VuZFBhcmFtZXRlcnNbJ0lkZW50aXR5J10pIHsgJFVzZXJTZWFyY2hlckFyZ3VtZW50c1snSWRlbnRpdHknXSA9ICRJZGVudGl0eSB9DQogICAgICAgIEdldC1Eb21haW5Vc2VyIEBVc2VyU2VhcmNoZXJBcmd1bWVudHMgfCBXaGVyZS1PYmplY3QgeyRfLnNhbWFjY291bnRuYW1lIC1uZSAna3JidGd0J30gfCBHZXQtRG9tYWluU1BOVGlja2V0IC1EZWxheSAkRGVsYXkgLU91dHB1dEZvcm1hdCAkT3V0cHV0Rm9ybWF0IC1KaXR0ZXIgJEppdHRlcg0KICAgIH0NCg0KICAgIEVORCB7DQogICAgICAgIGlmICgkTG9nb25Ub2tlbikgew0KICAgICAgICAgICAgSW52b2tlLVJldmVydFRvU2VsZiAtVG9rZW5IYW5kbGUgJExvZ29uVG9rZW4NCiAgICAgICAgfQ0KICAgIH0NCn0=
